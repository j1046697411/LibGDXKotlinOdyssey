# 文字游戏项目需求文档

## 目录
- [1. 项目概述](#1-项目概述)
- [2. 功能需求](#2-功能需求)
- [3. 技术架构](#3-技术架构)
- [4. 实现计划](#4-实现计划)
- [5. 验收标准](#5-验收标准)
- [6. 技术栈](#6-技术栈)
- [7. 预期交付时间](#7-预期交付时间)
- [8. 风险评估](#8-风险评估)

---

## 1. 项目概述

### 1.1 项目背景
本项目旨在基于现有的ECS（Entity Component System）框架（lko-ecs4）开发一款文字冒险游戏，重点实现AI角色系统和宗门基础世界，为玩家提供沉浸式的文字游戏体验。

### 1.2 项目目标
- 创建一个基于ECS框架的文字游戏核心引擎
- 实现可运行的AI角色系统，支持角色自主决策和行为
- 构建宗门基础世界，包括宗门结构、资源管理和发展机制
- 提供简洁的文字界面，支持玩家与游戏世界的交互

### 1.3 目标用户
- 18-35岁的文字游戏爱好者
- 喜欢策略和角色扮演游戏的玩家
- 对东方玄幻题材感兴趣的用户
- 喜欢深度剧情和角色发展的玩家
- 具备一定阅读能力和想象能力的用户

## 2. 功能需求

### 2.1 玩家交互系统

玩家交互系统定义了玩家如何与游戏世界进行互动，包括玩家角色定位、交互界面、操作方式和成长路径。

**玩家角色定位**
- **掌门模式**：玩家扮演宗门掌门，拥有最高决策权
  - 全权管理宗门事务，制定发展战略
  - 任命长老，分配资源，处理重大事件
  - 与其他宗门进行外交和贸易
- **长老模式**：玩家扮演特定长老，负责专项事务管理
  - 执法长老：维护宗门纪律，处理违规事件
  - 炼丹长老：管理丹药炼制和分配
  - 炼器长老：负责装备打造和维护
  - 传功长老：传授功法，指导弟子修炼
  - 财务长老：管理宗门财务和资源分配
- **弟子模式**：玩家扮演普通弟子，从底层开始成长
  - 外门弟子：完成基础任务，积累贡献点
  - 内门弟子：参与重要任务，使用宗门设施
  - 亲传弟子：接受长老指导，参与宗门决策
- **观察者模式**：玩家作为观察者，不直接参与管理
  - 观察AI角色行为，了解宗门运作
  - 分析游戏数据，制定策略

**交互界面设计**
- **文字界面**：基于命令行的文字交互界面
  - 命令格式：`动作 [目标] [参数]`
  - 支持命令补全和快捷键
  - 提供上下文相关的帮助信息
- **状态显示**：实时显示宗门状态、资源状况、角色信息
  - 宗门概况：弟子数量、资源总量、设施状况
  - 个人状态：修为、贡献点、职务、装备
  - 事件提醒：重要事件、任务提醒、危机预警
- **事件日志**：记录重要事件和决策结果
  - 按时间顺序显示事件
  - 支持按类型筛选事件
  - 提供事件详情和影响分析
- **操作菜单**：分层级的操作菜单系统
  - 主菜单：宗门管理、个人修炼、任务系统
  - 子菜单：资源分配、设施建设、弟子管理
  - 快捷操作：常用功能的快捷访问

**玩家与AI管理层交互**
- **指令下达**：玩家向AI角色下达指令
  - 直接指令：指定具体任务和目标
  - 策略指令：设定长期目标和优先级
  - 授权指令：授权AI角色自主决策
- **决策参与**：玩家参与宗门重大决策
  - 投票表决：根据职务权重参与投票
  - 建议提出：向管理层提出建议
  - 危机处理：参与处理突发事件
- **角色互动**：玩家与AI角色建立关系
  - 师徒关系：拜师学艺，传授功法
  - 同门关系：合作完成任务，建立友谊
  - 竞争关系：与其他角色竞争资源

**玩家与资源系统交互**
- **资源管理**：玩家参与资源分配和使用
  - 资源查看：查看各类资源库存和流动
  - 资源分配：分配资源给不同部门和角色
  - 资源交易：与其他宗门进行资源交易
- **贡献点使用**：玩家使用贡献点获取资源
  - 兑换灵石：将贡献点兑换为灵石
  - 购买物品：用贡献点购买丹药、装备
  - 使用设施：消耗贡献点使用宗门设施

**玩家与地图/试炼系统交互**
- **区域探索**：玩家探索和占领游戏区域
  - 区域查看：查看区域资源、设施、敌人
  - 区域占领：派遣弟子占领新区域
  - 区域开发：建设设施，提高资源产出
- **试炼参与**：玩家参与各种试炼活动
  - 个人试炼：提升个人修为和装备
  - 团队试炼：带领弟子团队完成试炼
  - 宗门试炼：参与宗门组织的集体试炼

**玩家成长路径**
- **修为提升**：通过修炼提升个人实力
  - 基础修炼：日常打坐修炼
  - 功法学习：学习不同等级的功法
  - 丹药辅助：使用丹药加速修炼
- **职务晋升**：通过贡献和实力获得晋升
  - 贡献积累：完成宗门任务获得贡献点
  - 实力要求：达到相应修为等级
  - 长老认可：获得现任长老的推荐
- **技能发展**：发展个人专长技能
  - 炼丹技能：炼制高品质丹药
  - 炼器技能：打造强力装备
  - 战斗技能：提升战斗能力

### 2.1.1 玩家交互系统技术实现

**交互系统架构**
```
[玩家输入] → [命令解析器] → [权限验证] → [动作执行器] → [结果反馈]
     ↓              ↓              ↓              ↓              ↓
[界面层]      [逻辑层]      [安全层]      [业务层]      [显示层]
```

**命令系统实现**
- **命令格式**：`动作 [目标] [参数]`
  - 动作：操作类型（查看、分配、建设、修炼等）
  - 目标：操作对象（资源、角色、设施等）
  - 参数：操作参数（数量、时间、优先级等）
- **命令解析**：
  - 正则表达式匹配命令格式
  - 上下文敏感的命令补全
  - 参数类型验证和转换
- **权限验证**：
  - 基于玩家角色的权限检查
  - 操作目标的可访问性验证
  - 资源使用限制检查

**界面系统实现**
- **状态显示组件**：
  - 实时数据更新机制
  - 条件触发的事件提醒
  - 多层级的信息展示
- **菜单系统**：
  - 树状结构的菜单导航
  - 快捷键绑定和自定义
  - 上下文相关的菜单项
- **日志系统**：
  - 时间戳的事件记录
  - 分类存储和检索
  - 影响分析和统计

**交互数据流**
```
玩家输入 → 命令解析 → 权限验证 → 业务逻辑 → 数据更新 → 界面刷新
     ↓         ↓         ↓         ↓         ↓         ↓
[UI事件]  [语法分析]  [安全检查]  [游戏逻辑]  [状态变更]  [视觉反馈]
```

**技术实现要点**
- **响应式设计**：界面实时响应游戏状态变化
- **异步处理**：长时间操作使用异步执行
- **错误处理**：完善的错误提示和恢复机制
- **性能优化**：大数据量的分页和懒加载
- **扩展性**：模块化设计支持功能扩展

**与ECS框架集成方案**
- **玩家实体组件**：
  - `PlayerComponent`：玩家身份标识和权限信息
  - `RoleComponent`：玩家当前角色类型和权限级别
  - `CommandComponent`：玩家输入的命令队列
  - `UIStateComponent`：界面状态和显示配置
- **交互系统**：
  - `InputSystem`：处理玩家输入和命令解析
  - `UISystem`：管理界面显示和状态更新
  - `PermissionSystem`：验证玩家操作权限
  - `FeedbackSystem`：生成操作结果反馈
- **数据流集成**：
  - 玩家操作通过ECS事件系统传递
  - 游戏状态变化通过组件更新反映到界面
  - 异步操作使用ECS的协程系统处理

**具体实现示例**
```kotlin
// 玩家命令组件
class CommandComponent : Component {
    val commandQueue = mutableListOf<GameCommand>()
    var currentCommand: GameCommand? = null
    var commandState = CommandState.IDLE
}

// 玩家权限组件
class PermissionComponent : Component {
    var roleType: PlayerRole = PlayerRole.DISCIPLE
    var permissions: Set<Permission> = emptySet()
    var resourceLimits: Map<ResourceType, Int> = emptyMap()
}

// 输入处理系统
class InputSystem : IteratingSystem(
    Family.all(PlayerComponent::class.java, CommandComponent::class.java).get()
) {
    override fun processEntity(entity: Entity, deltaTime: Float) {
        val commandComp = entity.getComponent(CommandComponent::class.java)
        // 处理玩家输入命令
        processPlayerInput(commandComp)
    }
}
```

**交互流程详细设计**

**命令处理流程**
1. **输入接收**：玩家输入命令文本
2. **语法解析**：解析命令格式和参数
3. **权限验证**：检查玩家是否有执行权限
4. **资源检查**：验证所需资源是否充足
5. **执行操作**：调用对应的业务逻辑
6. **结果反馈**：生成操作结果和界面更新

**错误处理机制**
- **语法错误**：命令格式不正确，提示正确用法
- **权限错误**：玩家权限不足，提示所需权限
- **资源错误**：资源不足，显示当前资源状况
- **逻辑错误**：操作条件不满足，提示具体原因
- **系统错误**：内部错误，记录日志并提示重试

**界面更新策略**
- **实时更新**：关键状态变化立即刷新界面
- **批量更新**：非关键变化累积后批量更新
- **条件更新**：满足特定条件时触发更新
- **用户触发**：玩家主动刷新界面

**性能优化措施**
- **命令缓存**：常用命令结果缓存
- **数据分页**：大数据量时分页显示
- **懒加载**：界面元素按需加载
- **异步处理**：耗时操作异步执行

### 2.2 核心功能概览

本项目包含以下核心功能系统，各系统之间通过资源流动和指令传递形成完整的游戏生态：

| 系统名称 | 主要功能 | 关键特性 |
|---------|---------|---------|
| **AI角色系统** | 控制角色自主决策和行为 | 层级管理、目标导向决策、行为多样性 |
| **宗门管理系统** | 管理宗门资源和设施 | 资源分配、设施建设、人口管理 |
| **道具系统** | 管理游戏物品和装备 | 五级稀有度、升级机制、流通交易 |
| **试炼系统** | 提供高级材料获取途径 | 三层试炼结构、风险收益平衡 |
| **功法系统** | 管理修炼和战斗技能 | 分类体系、传承机制、学习要求 |
| **地图系统** | 管理游戏世界区域 | 分层结构、占领机制、资源产出 |

#### 系统关系图
```
[AI管理层] ←→ [设施系统] ←→ [资源仓库] ←→ [资源分配] ←→ [人口系统]
     ↓              ↓              ↓              ↓              ↓
[试炼系统] ←→ [道具系统] ←→ [功法系统] ←→ [地图系统] ←→ [玩家交互]
```

### 2.1.1 世界创建与管理
- **世界初始化**：游戏启动时创建宗门基础世界
- **世界状态管理**：跟踪世界时间、天气、资源等状态
- **世界事件系统**：随机生成世界事件，影响游戏进程

#### 2.1.2 AI角色系统

AI角色系统是游戏的核心，负责控制宗门内所有角色的自主决策和行为。系统采用层级管理结构，确保角色行为的合理性和多样性。

**角色层级结构**
```
掌门（最高决策者）
    ↓
长老（专项管理者）
    ↓
亲传弟子（重要执行者）
    ↓
内门弟子（基础管理者）
```

**角色属性体系**

| 属性类别 | 属性名称 | 作用说明 | 数值范围 |
|---------|---------|---------|---------|
| **基本属性** | 修为境界 | 角色实力等级 | 炼气→筑基→金丹→元婴→化神 |
| | 年龄 | 角色年龄，影响寿命和潜力 | 15-500岁 |
| | 性别 | 角色性别，影响部分功法选择 | 男/女 |
| **资质属性** | 根骨 | 修炼资质，影响修炼速度 | 1-100 |
| | 悟性 | 学习能力，影响功法掌握速度 | 1-100 |
| | 福缘 | 运气值，影响奇遇概率 | 1-100 |
| | 心性 | 心理素质，影响突破成功率 | 1-100 |
| **性格属性** | 野心 | 权力欲望，影响决策倾向 | 1-100 |
| | 勤勉 | 勤奋程度，影响工作效率 | 1-100 |
| | 忠诚 | 对宗门忠诚度 | 1-100 |
| | 善良 | 道德倾向，影响社交行为 | 1-100 |

**角色行为类型**

| 行为类型 | 执行频率 | 主要参与者 | 行为效果 |
|---------|---------|---------|---------|
| **修炼行为** | 日常 | 所有角色 | 提升修为，突破境界 |
| **管理行为** | 定期 | 管理层角色 | 制定政策，分配资源 |
| **工作行为** | 按需 | 技术型角色 | 执行专业任务，产出资源 |
| **社交行为** | 随机 | 所有角色 | 建立关系，影响决策 |
| **决策行为** | 关键节点 | 管理层角色 | 影响宗门发展方向 |

**决策系统特性**
- **目标导向**：基于角色当前目标和优先级进行决策
- **环境适应**：能够根据宗门状况调整行为策略
- **权限分级**：不同层级角色具有不同的决策权限
- **学习能力**：角色能够从经验中学习并改进决策

#### 2.1.3 宗门管理系统

宗门管理系统负责管理宗门的组织结构、资源分配和设施建设，是游戏世界运行的基础框架。

**宗门层级结构**

| 层级 | 角色类型 | 数量 | 主要职责 | 管理权限 |
|-----|---------|-----|---------|---------|
| **核心管理层** | 掌门 | 1 | 最高决策、战略制定 | 全权管理 |
| | 长老 | 3-8 | 专项事务管理 | 分管领域 |
| | 亲传弟子 | 10-30 | 重要任务执行 | 管理内门弟子 |
| | 内门弟子 | 50-200 | 基础管理修炼 | 自身资源使用 |
| **资源层** | 外门弟子 | 200-1000 | 人才储备、基础工作 | 有限资源使用 |
| | 宗门杂役 | 500-5000 | 劳动力提供 | 基础生存保障 |
| | 凡俗百姓 | 10000+ | 基础资源产出 | 基本生存需求 |

**管理层职责与权限**

| 职务 | 职责范围 | 资源调配权限 | 管理范围 | 决策权重 |
|-----|---------|-------------|---------|---------|
| **掌门** | 全宗事务 | 无限制 | 所有角色 | 100% |
| **执法长老** | 纪律执法 | 执法资源 | 执法弟子 | 15% |
| **炼丹长老** | 丹药炼制 | 炼丹资源 | 炼丹弟子 | 15% |
| **炼器长老** | 装备打造 | 炼器资源 | 炼器弟子 | 15% |
| **传功长老** | 功法传授 | 功法资源 | 传功弟子 | 15% |
| **财务长老** | 财务管理 | 资金资源 | 财务弟子 | 15% |

**资源层产出机制**

| 资源类型 | 产出角色 | 年产出量 | 主要用途 | 价值评估 |
|---------|---------|---------|---------|---------|
| **基础资源** | 凡俗百姓 | 粮食：1.2石/人<br>布料：0.8匹/人 | 维持生存 | 基础价值 |
| **劳动力** | 宗门杂役 | 1单位/人 | 设施建设维护 | 中等价值 |
| **人才储备** | 外门弟子 | 潜在人才 | 选拔内门弟子 | 高价值 |

**权力分配原则**
- **层级原则**：上级对下级具有管理权限
- **专业原则**：专业事务由对应长老负责
- **贡献原则**：贡献度高的角色获得更多权限
- **平衡原则**：权力分配保持相对平衡，避免过度集中

- **人口资源系统**：
  - **人口类型**：
    - 凡俗百姓：通过区域占领获得的平民百姓，是宗门人口资源的基础，提供主要基础资源产出
    - 宗门杂役：从凡俗百姓中招募或转化的底层人员，提供劳动力
    - 外门弟子：从凡俗百姓或宗门杂役中选拔的有资质人员，作为人才储备
  - **人口管理**：
    - 人口数量：主要通过占领新区域获得凡俗百姓，同时受人口自然增长和流失影响
    - 人口质量：人口的平均资质和素质，影响资源产出效率和弟子选拔质量
    - 人口忠诚度：人口对宗门的忠诚度，影响稳定度、产出和弟子招募成功率
  - **人口产出**：
    - 基础资源：凡俗百姓每年提供粮食、布料等基础物资，产出公式为：年产出 = 人口数量 × 人均产出率 × 设施加成
    - 劳动力：宗门杂役提供劳动力，用于设施建设和维护，每个宗门杂役提供1单位劳动力
    - 人才储备：外门弟子中可能出现有潜力的人才，可选拔为内门弟子，选拔概率与外门弟子数量和资质相关
    - 产出示例：若宗门覆盖5万凡俗百姓，人均年产出率为1.2单位粮食和0.8单位布料，拥有10级农田（提供20%加成），则年产出为50000 × 1.2 × 1.2 = 72000单位粮食，50000 × 0.8 × 1.2 = 48000单位布料

- **资源管理**：
  - **基础资源**：
    - **生存资源**：
      - **粮食**：维持宗门人口生存的基础资源，主要从农田产出
        - 单位：石（1石=100斤）
        - 基础产出：每个凡俗百姓每年产出1.2石粮食
        - 消耗：每人每年消耗1石粮食（凡俗百姓）
        - 存储特性：可长期存储，但会随时间自然损耗（每年损耗率5%）
      - **布料**：制作衣物和日常用品的基础材料
        - 单位：匹（1匹=10丈）
        - 基础产出：每个凡俗百姓每年产出0.8匹布料
        - 消耗：每人每年消耗0.5匹布料（凡俗百姓）
        - 存储特性：可长期存储，损耗率较低（每年损耗率2%）
    - **建设资源**：
      - **木材**：建筑和设施建设的基础材料
        - 单位：方（1方=1立方米）
        - 基础产出：森林区域每平方公里每年产出50方木材
        - 消耗：1级建筑消耗100-500方木材
        - 存储特性：露天存储会自然损耗（每年损耗率10%）
      - **矿石**：金属制品和高级设施的基础材料
        - 单位：吨
        - 基础产出：矿脉区域每平方公里每年产出20吨矿石
        - 消耗：1级设施升级消耗50-200吨矿石
        - 存储特性：稳定存储，损耗率极低（每年损耗率1%）
    - **修炼资源**：
      - **灵石**：修炼和阵法运行的基础能量来源
        - 单位：块（标准灵石）
        - 基础产出：灵脉区域每平方公里每年产出1000块灵石
        - 消耗：炼气期弟子每年消耗100块，筑基期500块，金丹期2000块
        - 存储特性：能量会自然逸散（每年损耗率3%）
      - **灵草**：炼丹和制药的基础材料
        - 单位：株
        - 基础产出：灵草田每平方公里每年产出500株灵草
        - 消耗：基础丹药炼制消耗10-50株灵草
        - 存储特性：需要特殊存储条件（每年损耗率8%）
  - **高级资源**：功法、法宝、灵脉、秘境
  - **人口资源**：凡俗百姓、宗门杂役、外门弟子（作为特殊资源处理）

- **宗门贡献机制（内部货币系统）**：
  - **货币体系定位**：
    - **灵石**：游戏世界通用货币，用于外部交易、高级资源购买
    - **贡献点**：宗门内部专用货币，用于内部资源分配、设施使用、功法学习
    - **兑换关系**：1块灵石 ≈ 10-100贡献点（根据宗门经济状况浮动）

  - **贡献点获取途径**：
    - **任务完成**：完成宗门任务获得贡献点
      - 日常任务：10-50点贡献点
      - 重要任务：100-500点贡献点
      - 特殊任务：500-2000点贡献点
    - **试炼成果**：成功完成试炼获得贡献点
      - 小区域试炼：20-100点贡献点
      - 大区域试炼：100-500点贡献点
      - 宗门试炼：500-2000点贡献点
    - **资源贡献**：向宗门捐献资源获得贡献点
      - 基础资源：1点/10单位
      - 高级材料：1点/1单位
      - 稀有道具：10-100点/件
    - **设施建设**：参与设施建设获得贡献点
      - 基础设施：50-200点
      - 高级设施：200-1000点
      - 特殊设施：1000-5000点
    - **人才培养**：培养优秀弟子获得贡献点
      - 内门弟子晋升：100点/人
      - 亲传弟子晋升：500点/人
      - 长老晋升：2000点/人
    - **灵石兑换**：可用灵石兑换贡献点（兑换率由宗门经济状况决定）

  - **贡献点用途（内部消费）**：
    - **功法学习权限**：不同贡献点可学习不同级别功法
      - 基础功法：100点贡献点
      - 中级功法：500点贡献点
      - 高级功法：2000点贡献点
      - 顶级功法：5000点贡献点
    - **职务晋升**：贡献点是职务晋升的重要条件
      - 外门→内门：200点贡献点
      - 内门→亲传：1000点贡献点
      - 亲传→长老：5000点贡献点
    - **设施使用**：使用宗门设施需要消耗贡献点
      - 炼丹房：每次使用50-200点
      - 炼器房：每次使用30-150点
      - 修炼室：每小时10-50点
      - 藏经阁：查阅功法100-500点
    - **资源购买**：内部资源分配使用贡献点
      - 基础丹药：10-50点/颗
      - 中级丹药：50-200点/颗
      - 高级丹药：200-1000点/颗
      - 修炼材料：按品质定价
    - **试炼参与资格**：高级试炼需要相应贡献点
    - **决策投票权重**：贡献点影响决策投票权重

  - **贡献点计算规则**：
    - **贡献点特性**：
      - **永久性**：贡献点一旦获得，永久有效，不会随时间衰减
      - **可继承**：角色死亡或离开宗门时，贡献点可部分继承给指定弟子
      - **可转让**：在特定条件下，贡献点可在宗门内部转让
    - **贡献点上限**：
      - 外门弟子：1000点上限
      - 内门弟子：5000点上限
      - 亲传弟子：20000点上限
      - 长老：50000点上限
      - 掌门：无上限
    - **贡献点评级**：
      - 一级贡献：0-100点（新入门）
      - 二级贡献：101-500点（普通成员）
      - 三级贡献：501-2000点（积极成员）
      - 四级贡献：2001-5000点（核心成员）
      - 五级贡献：5001-20000点（精英成员）
      - 六级贡献：20001-50000点（长老级）
      - 七级贡献：50001+点（掌门级）
    - **特殊贡献计算**：
      - 重大发现：根据发现价值计算（100-5000点）
      - 危机处理：根据危机程度计算（200-10000点）
      - 传承贡献：传授功法给弟子（50-500点/人）

  - **贡献点兑换系统**：
    - **兑换灵石**：
      - 基础兑换：1贡献点 = 0.1-1块灵石（根据宗门经济状况浮动）
      - 批量兑换：大宗兑换可获得更优惠汇率
      - 限制条件：每月兑换上限与职务等级相关
    - **兑换物品**：
      - 基础丹药：10-50贡献点/颗
      - 中级丹药：50-200贡献点/颗
      - 高级丹药：200-1000贡献点/颗
      - 修炼材料：按品质定价
      - 功法秘籍：100-5000贡献点/本
    - **兑换设施使用权**：
      - 炼丹房：50-200贡献点/次
      - 炼器房：30-150贡献点/次
      - 修炼室：10-50贡献点/小时
      - 藏经阁：100-500贡献点/次
    - **兑换限制**：
      - 职务限制：不同职务有不同兑换权限
      - 时间限制：部分稀有物品有兑换冷却时间
      - 数量限制：热门物品有每月兑换数量限制

  - **贡献点与建筑系统关联**：
    - **设施建设贡献**：
      - 参与建设：根据设施等级获得贡献点奖励
        - 1级设施：50-100点
        - 2级设施：100-200点
        - 3级设施：200-500点
        - 4级设施：500-1000点
        - 5级设施：1000-2000点
      - 设计贡献：提出建设方案获得额外贡献点
      - 维护贡献：参与设施维护获得持续贡献点
    - **设施使用消耗**：
      - 高级设施使用需要消耗贡献点
      - 设施等级越高，使用消耗越大
      - 特殊设施需要特定贡献点评级才能使用
    - **建筑权限**：
      - 不同贡献点评级可建设不同等级设施
      - 高评级角色可参与更高级别设施规划

  - **贡献点奖励机制**：
    - **定期奖励**：
      - 月度贡献榜：前10名获得额外资源奖励（100-1000点）
      - 季度贡献榜：前5名获得高级功法或装备（500-5000点）
      - 年度贡献榜：前3名获得特殊称号和权限（1000-10000点）
    - **特殊成就奖励**：
      - 贡献点突破：达到新评级时获得一次性奖励（200-2000点）
      - 连续贡献：连续12个月有贡献活动获得额外奖励（500点）
      - 重大贡献：单次贡献超过1000点获得特殊奖励（额外50%）
    - **排名奖励**：
      - 贡献点排名影响资源分配比例（前10%获得双倍配额）
      - 高排名角色获得更多修炼资源配额
      - 排名前10%角色获得特殊设施使用权
    - **传承奖励**：
      - 高贡献点角色在传承功法时成功率更高（+10%-30%）
      - 贡献点影响弟子继承遗产的优先级
      - 贡献点高的角色在宗门历史中留名
  - 资源获取：
    - **区域占领产出（主要来源）**：通过占领区域获得基础资源产量和凡俗百姓资源
      - 占领区域自动获得该区域的资源产出权，包括基础资源（木材、矿石、粮食）和高级资源（灵石、灵草）
      - 占领区域时自动获得该区域内的凡俗百姓，作为宗门的人口资源基础
      - 产出量与区域类型、面积、控制度和设施等级直接相关
    - 采集炼制：核心角色通过工作行为优化资源产出并炼制高级物品（丹药、法宝等）
    - 交易掠夺：与其他宗门进行交易或掠夺获取稀缺资源补充
  - 资源消耗模型：
    - **AI管理层工资与资源消耗**（掌门→长老→亲传弟子→内门弟子）：
      - **职务工资**：不同职务有固定工资，作为AI角色的基础收入
        - 掌门：每年1000单位灵石+500单位丹药
        - 长老：每年800单位灵石+300单位丹药
        - 亲传弟子：每年500单位灵石+100单位丹药
        - 内门弟子：每年200单位灵石+50单位丹药
      - 修炼消耗：不同修为等级消耗不同资源，如炼气期每年消耗100单位灵石，筑基期500单位，金丹期2000单位
      - 管理消耗：处理宗门事务消耗资源，如召开长老会议消耗500单位灵石和100单位丹药
      - 社交消耗：与其他宗门或重要人物交往消耗资源，如赠送礼物消耗高级丹药或法宝
      - 决策消耗：AI角色做出决策时消耗精神力资源，精神力可通过休息或特殊资源恢复
    - **设施系统资源消耗**：
      - 建设消耗：不同设施有不同建设成本，如1级农田消耗1000单位灵石、5000单位粮食和100单位劳动力
      - 维护消耗：定期消耗资源维持设施运行，如1级农田每年消耗50单位灵石和500单位粮食
      - 升级消耗：设施升级消耗大量资源，如1级农田升级到2级消耗2000单位灵石和10000单位粮食
      - 运行消耗：使用设施时消耗资源，如炼丹房每次炼丹消耗100单位灵草和50单位灵石
      - 效率消耗：高级设施运行时额外消耗资源以提供更高效率，如2级炼丹房每次炼丹多消耗20单位灵草，但产出提高30%
    - **人口资源维持成本**：
      - 凡俗百姓：每人每年消耗1单位粮食和0.5单位布料
      - 宗门杂役：每人每年消耗1.2单位粮食和0.6单位布料
      - 外门弟子：每人每年消耗1.5单位粮食、0.8单位布料和10单位灵石
    - **资源消耗计算机制**：
      - 定期结算：所有资源消耗按年度/月度定期结算，与资源产出周期保持一致
      - 工资发放：职务工资按月度/季度发放，作为AI角色的基础收入
      - 优先级消耗：当资源不足时，系统自动按以下优先级消耗资源：职务工资 > 修炼资源 > 管理消耗 > 设施维护 > 人口维持
      - 消耗叠加：同一实体的多种消耗（如掌门的职务工资+修炼消耗）会叠加计算
      - 效率影响：设施效率加成会影响资源消耗，如高级管理设施可减少10%的管理资源消耗
    - **灵石经济模型**：
      
      **灵石产出机制**
      - **灵脉产出（主要来源）**：
        - **小型灵脉**：每平方公里每年产出500-1000块灵石
        - **中型灵脉**：每平方公里每年产出1000-3000块灵石
        - **大型灵脉**：每平方公里每年产出3000-8000块灵石
        - **极品灵脉**：每平方公里每年产出8000-20000块灵石
        - 产出受灵脉品质、开采技术、设施等级影响
      - **区域占领收益**：
        - 占领灵脉区域自动获得灵石产出
        - 产出量 = 灵脉基础产量 × 控制度 × 开采效率
        - 控制度：0-100%，受区域稳定性和防御设施影响
      - **试炼奖励**：
        - **小区域试炼**：完成奖励50-200块灵石
        - **大区域试炼**：完成奖励200-800块灵石
        - **宗门试炼**：完成奖励1000-5000块灵石
        - 奖励随试炼难度和完成评价浮动
      - **交易获取**：
        - **资源出售**：出售基础资源、丹药、装备换取灵石
        - **服务提供**：提供炼丹、炼器、阵法等服务换取灵石
        - **外部雇佣**：完成外部委托任务获得灵石报酬
      - **特殊事件**：
        - **灵脉发现**：探索发现新灵脉，一次性获得大量灵石
        - **遗迹探索**：探索古代遗迹获得灵石宝藏
        - **宗门奖励**：完成重大任务获得宗门灵石奖励
      
      **灵石消耗机制**
      - **角色修炼消耗**：
        - **炼气期**：每年消耗100-300块灵石
        - **筑基期**：每年消耗500-1500块灵石
        - **金丹期**：每年消耗2000-6000块灵石
        - **元婴期**：每年消耗8000-20000块灵石
        - **化神期**：每年消耗30000-80000块灵石
        - 消耗量受功法品质、修炼速度、天赋影响
      - **职务工资支出**：
        - **掌门**：每年1000-3000块灵石
        - **长老**：每年800-2000块灵石
        - **亲传弟子**：每年500-1200块灵石
        - **内门弟子**：每年200-500块灵石
        - 工资水平受宗门经济状况和角色贡献影响
      - **设施运行消耗**：
        - **炼丹房**：每次炼丹消耗50-200块灵石
        - **炼器房**：每次炼器消耗30-150块灵石
        - **修炼室**：每小时消耗5-20块灵石
        - **阵法**：护宗大阵每年消耗5000-20000块灵石
        - 消耗量随设施等级和使用频率增加
      - **炼制材料消耗**：
        - **丹药炼制**：高级丹药需要灵石作为辅助材料
        - **装备打造**：法宝炼制需要灵石提供能量
        - **阵法布置**：布置阵法需要消耗大量灵石
        - 消耗量随物品等级和品质提高
      - **维护成本**：
        - **设施维护**：高级设施定期维护需要灵石
        - **资源存储**：灵石仓库维护防止灵气逸散
        - **损耗补偿**：灵石自然损耗的补充
      
      **灵石转移机制**
      - **交易转移**：宗门间交易、角色间交易，灵石所有权转移但总量不变
      - **工资发放**：宗门发放职务工资，灵石从宗门仓库转移到角色个人账户
      - **贡献点兑换**：角色用贡献点兑换灵石，灵石从宗门仓库转移到角色账户
      
      **灵石总量守恒原则**
       - 除实际消耗外，灵石在游戏世界中总量基本守恒
       - 灵石转移只是改变所有权，不会减少总量
       - 实际消耗的灵石会从游戏世界中永久消失
       
       **灵石经济平衡模型**
       - **供需平衡机制**：
         - **产出调节**：灵脉产出受开采技术和设施等级影响，可调节产出量
         - **消耗控制**：AI角色根据灵石储备自动调整消耗策略
         - **价格调节**：灵石稀缺时，贡献点兑换率下降，交易价格上升
         - **储备管理**：宗门维持一定灵石储备应对突发事件
       - **平衡指标**：
         - **储备充足率**：灵石储备 / 年消耗量，理想值在200%-300%
         - **产出消耗比**：年产出量 / 年消耗量，理想值在120%-150%
         - **流动比率**：可动用灵石 / 固定消耗，理想值在150%-200%
         - **债务比率**：灵石债务 / 年产出量，警戒线为50%
       - **经济周期**：
         - **繁荣期**：灵石充足，消耗增加，建设加速
         - **平稳期**：供需平衡，稳定发展
         - **紧缩期**：灵石短缺，消耗控制，优先保障核心需求
         - **危机期**：储备耗尽，触发危机事件
       - **平衡策略**：
         - **开源策略**：积极寻找新灵脉，提高开采效率
         - **节流策略**：控制非必要消耗，优化资源使用
         - **交易策略**：通过交易调节灵石流动
         - **储备策略**：建立战略储备应对突发事件
       - **平衡示例**：
         - 假设宗门拥有中型灵脉（年产出2000块），控制度80%，开采效率120%
         - 年产出 = 2000 × 0.8 × 1.2 = 1920块灵石
         - 年消耗：掌门1000 + 长老1600 + 弟子3000 + 设施2000 + 维护500 = 8100块
         - 产出消耗比 = 1920 / 8100 ≈ 23.7%（严重不平衡）
        - 需要采取平衡措施：增加灵脉控制、提高开采效率、控制消耗
        
        **灵石系统技术实现**
        - **灵石实体组件**：
          - `SpiritStoneComponent`：灵石数量、品质、归属信息
          - `MineComponent`：灵脉属性、产出率、开采状态
          - `ConsumptionComponent`：消耗记录、消耗模式、优先级
          - `BalanceComponent`：经济指标、平衡状态、预警级别
        - **灵石管理系统**：
          - `MineSystem`：管理灵脉产出和开采效率
          - `ConsumptionSystem`：处理灵石消耗和优先级分配
          - `BalanceSystem`：监控经济平衡并触发调整策略
          - `TradeSystem`：处理灵石交易和兑换
        - **平衡算法**：
          - **动态调节**：根据储备充足率自动调整消耗策略
          - **优先级分配**：按核心需求>重要需求>一般需求分配灵石
          - **预警机制**：多级预警触发不同的应对措施
          - **AI决策**：AI角色根据经济状况制定发展策略
        - **实现示例**：
        ```kotlin
        // 灵石平衡组件
        class BalanceComponent : Component {
            var reserveRatio: Float = 0f // 储备充足率
            var productionConsumptionRatio: Float = 0f // 产出消耗比
            var liquidityRatio: Float = 0f // 流动比率
            var warningLevel: WarningLevel = WarningLevel.NORMAL
            var balanceStrategy: BalanceStrategy = BalanceStrategy.STABLE
        }
        
        // 平衡系统
        class BalanceSystem : IteratingSystem(
            Family.all(BalanceComponent::class.java, SpiritStoneComponent::class.java).get()
        ) {
            override fun processEntity(entity: Entity, deltaTime: Float) {
                val balanceComp = entity.getComponent(BalanceComponent::class.java)
                val stoneComp = entity.getComponent(SpiritStoneComponent::class.java)
                
                // 计算经济指标
                calculateEconomicIndicators(balanceComp, stoneComp)
                
                // 触发平衡策略
                if (balanceComp.reserveRatio < 1.0f) {
                    triggerConsumptionControl(balanceComp)
                }
                
                // 更新预警级别
                updateWarningLevel(balanceComp)
            }
        }
        ```
      - **资源消耗平衡机制**：
      - 消耗预警：当某种资源消耗率超过产出率的80%时，系统触发预警事件
      - 自动调整：AI管理层会根据资源消耗情况自动调整策略，如减少非必要消耗或增加产出
      - 危机处理：当资源极度短缺时，触发危机事件（如弟子叛乱、设施损坏等）
  - **资源分配与货币体系**：
    - **灵石使用场景**：
      - 外部交易：与其他宗门交易、购买外部资源
      - 高级资源：炼制高级丹药、打造高级装备
      - 设施建设：建设高级设施、升级现有设施
      - 外部雇佣：雇佣外部修士、购买外部服务
    - **贡献点使用场景**：
      - 内部资源：购买宗门内部资源、丹药、功法
      - 设施使用：使用炼丹房、炼器房、修炼室等设施
      - 功法学习：学习宗门功法、查阅藏经阁
      - 职务晋升：满足职务晋升的贡献点要求
    - **分配策略**：
      - 基于角色职务和贡献点分配内部资源
      - 优先满足核心管理层的修炼和工作需求
      - 资源分配策略由AI角色（主要是掌门和长老）根据宗门发展目标制定
    - **分配示例**：若宗门有5万凡俗百姓、1万宗门杂役和5千外门弟子，每年维持成本为：
      - 粮食：50000×1 + 10000×1.2 + 5000×1.5 = 50000 + 12000 + 7500 = 69500单位
      - 布料：50000×0.5 + 10000×0.6 + 5000×0.8 = 25000 + 6000 + 4000 = 35000单位
      - 灵石：5000×10 = 50000单位（假设每个外门弟子每年消耗10单位灵石）
      - 贡献点：内部资源分配主要通过贡献点进行
    - **分配优先级**：修炼资源 > 管理消耗 > 设施维护 > 人口维持
  - 资源转换：
    - 人口资源产出的基础资源可用于支持核心角色的修炼和设施建设
    - 高级资源可用于提升核心角色的修为和设施等级，间接提高人口资源的产出效率
    - 资源转换效率：高级资源转换为基础资源效率较低，反之亦然
  - 资源平衡：
    - 系统自动监控资源供需平衡，当某种资源短缺或过剩时触发相应事件
    - AI角色需要根据资源状况调整管理策略，如增加人口数量、升级生产设施或调整资源分配
  - 资源仓库管理：
    - 存储容量：不同级别的仓库有不同存储容量，可通过消耗资源升级
    - 资源损耗：部分资源（如丹药、灵草）会随时间自然损耗，高级资源损耗率更低
    - 存储成本：维护仓库需要定期消耗少量资源

#### 2.1.4 道具系统

道具系统管理游戏中的所有物品，包括丹药、材料、装备和功法秘籍，是资源流通和角色强化的核心。

**道具分类体系**

| 道具类别 | 子类别 | 主要功能 | 获取方式 | 外部价值（灵石） | 内部价值（贡献点） |
|---------|-------|---------|---------|----------------|------------------|
| **丹药类** | 基础丹药 | 恢复、治疗 | 炼制 | 10-300灵石 | 100-3000点 |
| | 中级丹药 | 修炼辅助 | 炼制 | 200-800灵石 | 2000-8000点 |
| | 高级丹药 | 突破辅助 | 炼制 | 1000-8000灵石 | 10000-80000点 |
| **材料类** | 基础材料 | 基础炼制 | 采集 | 10-100灵石 | 100-1000点 |
| | 高级材料 | 高级炼制 | 试炼 | 500-15000灵石 | 5000-150000点 |
| **装备类** | 武器 | 攻击增强 | 打造/试炼 | 50-100000灵石 | 500-1000000点 |
| | 防具 | 防御增强 | 打造/试炼 | 30-200000灵石 | 300-2000000点 |
| | 饰品 | 属性提升 | 打造/试炼 | 200-100000灵石 | 2000-1000000点 |
| **功法秘籍** | 修炼功法 | 修为提升 | 传承/试炼 | 100-3000灵石 | 1000-30000点 |
| | 战斗功法 | 战斗增强 | 传承/试炼 | 80-8000灵石 | 800-80000点 |
| | 辅助功法 | 技能提升 | 传承/试炼 | 200-3000灵石 | 2000-30000点 |

**丹药类道具详细规格**

| 丹药名称 | 品级 | 炼制材料 | 效果描述 | 冷却时间 | 价值范围 |
|---------|-----|---------|---------|---------|---------|
| **回气丹** | 基础 | 灵草×10+灵石×5 | 恢复灵气100-200点 | 30分钟 | 10-20灵石 |
| **疗伤丹** | 基础 | 灵草×15+灵石×8 | 恢复生命200-300点 | 1小时 | 15-25灵石 |
| **聚气丹** | 中级 | 灵草×30+灵石×20 | 修炼速度+20%持续2小时 | 4小时 | 50-80灵石 |
| **筑基丹** | 中级 | 灵草×50+灵石×100 | 筑基成功率+15% | 一次性 | 200-300灵石 |
| **金丹丸** | 高级 | 灵草×100+灵石×500+金丹草×5 | 金丹成功率+10% | 一次性 | 1000-1500灵石 |
| **延寿丹** | 高级 | 灵草×200+灵石×1000+延寿果×10 | 延长寿命10年 | 限用3次 | 5000-8000灵石 |

**装备稀有度体系**

| 稀有度 | 武器攻击力 | 防具防御力 | 制作材料 | 升级路径 | 价值范围 |
|-------|----------|----------|---------|---------|---------|
| **凡器** | 10-30 | 5-15 | 基础矿石+木材 | 可升级 | 50-300灵石 |
| **法器** | 50-100 | 30-60 | 灵铁+灵石 | 可升级 | 300-1500灵石 |
| **灵器** | 150-300 | 80-150 | 星辰铁+灵石 | 可升级 | 1500-5000灵石 |
| **仙器** | 500-1000 | 300-600 | 仙金+灵石 | 可升级 | 5000-20000灵石 |
| **神器** | 2000-5000 | 1000-2000 | 神级材料 | 无法打造 | 20000-100000灵石 |

**道具流通机制特点**
- **基础货币**：灵石作为所有道具交易的基础货币
- **交易方式**：宗门内部交易、外部交易、拍卖系统
- **价格波动**：受供需关系、炼制难度、稀有程度影响
- **自动流通**：AI角色根据需求自动进行道具交易
    - **装备类**：
      - **武器**：
        - **凡器**：普通武器，消耗50单位矿石+10单位木材打造
          - 属性：攻击力+10-30，耐久度100-200
          - 价值：50-100块灵石
        - **法器**：蕴含灵气的武器，消耗100单位矿石+50单位灵石+5单位灵铁打造
          - 属性：攻击力+50-100，附带特殊效果（如火焰、冰冻）
          - 价值：300-600块灵石
        - **灵器**：高级灵性武器，消耗200单位矿石+200单位灵石+10单位星辰铁打造
          - 属性：攻击力+150-300，可认主，随主人修为提升
          - 价值：2000-4000块灵石
        - **仙器**：传说中的仙级武器，消耗500单位矿石+1000单位灵石+1单位仙金打造
          - 属性：攻击力+500-1000，附带仙级特效，可成长
          - 价值：20000-50000块灵石
        - **神器**：神级武器，无法直接打造，只能通过仙器升级获得
          - 属性：攻击力+2000-5000，附带神级特效，可进化
          - 价值：100000-500000块灵石
      - **防具**：
        - **布甲**：基础防具，消耗20单位布料+5单位木材制作
          - 属性：防御力+5-15，耐久度80-150
          - 价值：30-60块灵石
        - **铁甲**：金属防具，消耗80单位矿石+20单位木材+3单位精铁打造
          - 属性：防御力+30-60，耐久度200-300
          - 价值：150-250块灵石
        - **灵甲**：灵性防具，消耗150单位矿石+100单位灵石+8单位玄铁打造
          - 属性：防御力+80-150，附带防护罩效果
          - 价值：800-1200块灵石
        - **仙甲**：仙级防具，消耗300单位矿石+500单位灵石+1单位仙晶打造
          - 属性：防御力+300-600，附带仙级防护
          - 价值：15000-30000块灵石
        - **神甲**：神级防具，无法直接打造，只能通过仙甲升级获得
          - 属性：防御力+1000-2000，附带神级防护
          - 价值：80000-200000块灵石
      - **饰品**：
        - **储物戒指**：存储物品，消耗50单位矿石+30单位灵石制作
          - 属性：存储空间1-5立方米
          - 价值：200-400块灵石
        - **护身符**：提供保护，消耗30单位灵草+50单位灵石+3单位护身玉制作
          - 属性：自动抵挡一次致命攻击，冷却时间24小时
          - 价值：500-800块灵石
        - **仙饰**：仙级饰品，消耗100单位灵草+200单位灵石+1单位仙玉制作
          - 属性：全属性提升20%，附带特殊仙术
          - 价值：8000-12000块灵石
        - **神饰**：神级饰品，无法直接打造，只能通过仙饰升级获得
          - 属性：全属性提升50%，附带神级仙术
          - 价值：50000-100000块灵石
      - **高级材料道具获取机制**：
        - **武器材料道具分类**：
          - **灵铁**：打造法器的关键材料道具
            - 获取方式：灵铁矿脉试炼
            - 试炼难度：中等，需要筑基期修为
            - 获取概率：每次试炼有40%概率获得3-8单位
            - 价值：50-80块灵石/单位
          - **星辰铁**：打造灵器的关键材料道具
            - 获取方式：星辰陨落区域试炼
            - 试炼难度：高，需要金丹期修为
            - 获取概率：每次试炼有25%概率获得2-5单位
            - 价值：200-300块灵石/单位
          - **仙金**：打造仙器的关键材料道具
            - 获取方式：仙界碎片试炼
            - 试炼难度：极高，需要元婴期以上修为
            - 获取概率：每次试炼有8%概率获得1单位
            - 价值：5000-8000块灵石/单位
        - **防具材料道具分类**：
          - **精铁**：打造铁甲的关键材料道具
            - 获取方式：精铁矿脉试炼
            - 试炼难度：中等，需要筑基期修为
            - 获取概率：每次试炼有45%概率获得4-10单位
            - 价值：30-50块灵石/单位
          - **玄铁**：打造灵甲的关键材料道具
            - 获取方式：玄铁矿脉试炼
            - 试炼难度：高，需要金丹期修为
            - 获取概率：每次试炼有30%概率获得3-6单位
            - 价值：100-150块灵石/单位
          - **仙晶**：打造仙甲的关键材料道具
            - 获取方式：仙晶矿脉试炼
            - 试炼难度：极高，需要元婴期以上修为
            - 获取概率：每次试炼有10%概率获得1单位
            - 价值：3000-5000块灵石/单位
        - **饰品材料道具分类**：
          - **护身玉**：制作护身符的关键材料道具
            - 获取方式：玉石矿脉试炼
            - 试炼难度：中等，需要筑基期修为
            - 获取概率：每次试炼有35%概率获得2-5单位
            - 价值：80-120块灵石/单位
          - **仙玉**：制作仙饰的关键材料道具
            - 获取方式：仙玉矿脉试炼
            - 试炼难度：极高，需要元婴期以上修为
            - 获取概率：每次试炼有6%概率获得1单位
            - 价值：2000-3000块灵石/单位
        - **武器试炼特殊机制**：
          - **武器试炼类型**：
            - **矿脉试炼**：灵铁矿脉、星辰陨落区域、仙界碎片等
            - **锻造试炼**：古锻造场、神兵遗迹等
            - **元素试炼**：火元素领域、冰元素领域等
            - **武器大师试炼**：与武器大师切磋技艺
          - **试炼特色**：
            - **武器试炼**更注重战斗技巧和武器使用
            - **锻造试炼**需要掌握锻造技艺
            - **元素试炼**需要对应元素抗性
            - **武器大师试炼**可获得特殊锻造图纸
          - **试炼奖励**：
            - 除了材料外，还可能获得武器图纸
            - 有概率直接获得成品武器
            - 提升武器使用熟练度
            - 解锁特殊武器技能

    - **装备升级系统**：
      - **升级机制概述**：
        - 神器级别装备无法直接打造，只能通过升级现有装备获得
        - 升级需要消耗大量高级材料和低级装备作为喂养材料
        - 升级成功率与材料品质、角色技能、装备基础有关
        - 升级失败可能导致装备损坏或降级
      - **升级材料要求**：
        - **仙器升级为神器**：
          - 基础装备：仙器级别武器/防具/饰品
          - 主要材料：神级材料（神铁、神晶、神玉等）
          - 喂养材料：高级材料（灵脉精华、古兵残片等）或低级装备（凡器、法器）
          - 辅助材料：大量灵石（10000-50000块）
          - 技能要求：神级锻造技能或元婴期以上修为
        - **灵器升级为仙器**：
          - 基础装备：灵器级别装备
          - 主要材料：仙级材料（仙金、仙晶、仙玉等）
          - 喂养材料：中级材料（星辰铁、玄铁等）或低级装备
          - 辅助材料：大量灵石（5000-20000块）
          - 技能要求：仙级锻造技能或金丹期以上修为
      - **升级成功率**：
        - **基础成功率**：
          - 灵器→仙器：30-50%
          - 仙器→神器：10-25%
        - **成功率提升因素**：
          - 材料品质：使用更高品质材料可提升成功率
          - 角色技能：锻造技能等级越高，成功率越高
          - 装备基础：装备初始品质越好，成功率越高
          - 辅助道具：使用特殊丹药或道具可临时提升成功率
        - **失败后果**：
          - 轻度失败：装备耐久度下降，材料损失50%
          - 中度失败：装备降级（如仙器降为灵器），材料全部损失
          - 重度失败：装备损坏无法修复，材料全部损失
      - **升级效果**：
        - **属性提升**：装备基础属性大幅提升
        - **特效增强**：原有特效升级为更强大的效果
        - **新增特性**：可能获得新的特殊能力
        - **成长性**：神器具有更强的成长潜力，可继续进化
      - **升级场所**：
        - **宗门锻造坊**：需要高级锻造设施
        - **神兵阁**：专门用于装备升级的特殊建筑
        - **秘境升级**：特定秘境提供成功率加成
        - **大师指导**：有锻造大师指导可提升成功率
      - **AI角色升级行为**：
        - **材料收集**：AI角色会根据升级需求主动收集材料
        - **技能提升**：有升级需求的角色会优先提升锻造技能
        - **风险评估**：AI会评估升级风险和收益
        - **时机选择**：选择成功率较高的时机进行升级

    - **功法类**：
      - **基础功法**：
        - **引气诀**：基础修炼功法，适合炼气期弟子
          - 效果：修炼速度+10%，灵气恢复+5%
          - 修炼要求：无特殊要求
          - 价值：100-200块灵石
        - **基础剑法**：基础战斗功法，提升剑术能力
          - 效果：剑术攻击力+15%，命中率+5%
          - 修炼要求：力量属性≥10
          - 价值：150-250块灵石
      - **中级功法**：
        - **凝气诀**：中级修炼功法，适合筑基期弟子
          - 效果：修炼速度+25%，灵气上限+10%
          - 修炼要求：炼气期圆满
          - 价值：500-800块灵石
        - **御剑术**：中级战斗功法，可远程操控飞剑
          - 效果：飞剑攻击力+40%，操控距离+20米
          - 修炼要求：筑基期，神识≥20
          - 价值：800-1200块灵石
      - **高级功法**：
        - **金丹诀**：高级修炼功法，适合金丹期长老
          - 效果：修炼速度+50%，突破概率+8%
          - 修炼要求：筑基期圆满
          - 价值：2000-3000块灵石
        - **天雷剑法**：高级战斗功法，引动天雷攻击
          - 效果：攻击力+100%，附带雷电效果
          - 修炼要求：金丹期，雷灵根
          - 价值：5000-8000块灵石
  - **道具流通机制**：
    - **基础交易货币**：灵石作为所有道具交易的基础货币
    - **交易方式**：
      - **宗门内部交易**：AI角色之间使用灵石进行道具交换
      - **外部交易**：与其他宗门进行道具买卖，价格受市场供需影响
      - **拍卖系统**：稀有道具可通过拍卖获得更高价格
    - **价格波动因素**：
      - 供需关系：某种道具需求量大时价格上涨
      - 炼制难度：炼制成功率影响道具价格
      - 稀有程度：稀有道具价格更高
      - 宗门关系：友好宗门间交易价格更优惠
    - **道具流通规则**：
      - AI角色可根据需求自动购买或出售道具
      - 道具可在角色间赠送，影响角色关系
      - 稀有道具可作为任务奖励或外交礼物
  - **道具与AI角色交互**：
    - **自动使用**：AI角色在需要时自动使用合适道具（如受伤时使用疗伤丹）
    - **道具偏好**：不同性格角色对道具有不同偏好（如暴躁角色偏好攻击性道具）
    - **道具交易**：AI角色可根据自身资源状况进行道具买卖
    - **道具传承**：高级道具可在师徒或上下级间传承

- **系统互动关系**：
  - **AI管理层 ←→ 设施系统**：
    - AI管理层消耗资源（如灵石、丹药）下达指令，指导设施建设、升级和运行
    - 设施系统提供效率加成，减少AI管理层的资源消耗并提高整体产出效率
    - 资源流动路径：AI管理层 → 资源消耗 → 设施系统 → 效率加成 → AI管理层
    - 互动示例：长老消耗500单位灵石下令升级农田，升级后农田产出效率提升20%，减少未来粮食资源的消耗压力
    - 决策影响：AI管理层根据设施效率和资源状况调整指令，如优先升级瓶颈设施
  - **设施系统 ←→ 人口资源层**：
    - 设施系统为人口资源层提供生产工具、技术支持和工作条件
    - 人口资源层提供劳动力建设、维护和运行设施，同时通过设施提高资源产出
    - 资源流动路径：人口资源层 → 劳动力 → 设施系统 → 生产条件 → 人口资源层
    - 互动示例：建设矿场需要100单位劳动力（来自宗门杂役），建成后凡俗百姓可在矿场工作，矿石年产出增加500单位
    - 效率关联：设施等级越高，对人口资源层的产出加成越高，但需要更多劳动力维护
  - **资源仓库 ←→ 资源分配 ←→ 人口系统**：
    - 资源仓库存储所有资源，有容量限制和自然损耗机制
    - 资源分配系统根据AI管理层指令、优先级规则和人口需求进行资源分配
    - 人口系统的产出存入资源仓库，同时消耗仓库资源维持生存和发展
    - 资源流动路径：人口系统 → 资源产出 → 资源仓库 → 资源分配 → 人口系统
    - 互动示例：凡俗百姓每年产出10000单位粮食存入仓库，分配系统优先将5000单位分配给AI管理层和内门弟子，3000单位分配给外门弟子和宗门杂役，剩余2000单位作为储备
    - 分配规则：资源分配优先级为修炼资源 > 管理消耗 > 设施维护 > 人口维持
  - **人口系统 ←→ 满意度/增长**：
    - 资源分配充足度、设施条件和管理政策共同影响人口满意度
    - 满意度直接影响人口增长率、产出效率和稳定性
    - 资源流动路径：人口系统 → 资源消耗 → 满意度 → 人口增长/产出效率 → 人口系统
    - 互动示例1：资源分配充足，人口满意度从60%提升到90%，增长率从1%提升到2%，资源产出效率提高10%
    - 互动示例2：资源短缺导致满意度降至30%，人口增长率变为-0.5%，部分凡俗百姓逃离宗门
  - **AI管理层 ←→ 人口资源层**：
    - AI管理层通过政策和资源分配间接影响人口资源层
    - 人口资源层的产出支持AI管理层的修炼和管理活动
    - 资源流动路径：人口资源层 → 资源产出 → AI管理层 → 政策/资源分配 → 人口资源层
    - 互动示例：掌门制定"休养生息"政策，增加对凡俗百姓的资源投入，提高粮食收购价格，导致粮食年产出增加15%
  - **设施系统 ←→ 资源仓库**：
    - 设施系统的建设、维护和升级消耗仓库资源
    - 设施系统的产出存入资源仓库
    - 资源流动路径：资源仓库 → 资源消耗 → 设施系统 → 资源产出 → 资源仓库
    - 互动示例：从仓库取出2000单位灵石升级炼丹房，升级后每次炼丹产出增加50%，丹药存入仓库

- **设施建设**：
  - 基础设施：主殿、山门、弟子居、伙房
  - 功能设施：修炼室、炼丹房、炼器阁、藏经阁、阵法堂
  - 生产设施：农田、矿场、工坊（用于提升资源产出效率）
  - 防御设施：护山大阵、哨塔、地牢
  - 升级系统：设施可通过消耗资源进行升级，提升功能效果和资源产出

- **人才选拔**：
  - 资质检测：定期对外门弟子和凡俗百姓进行资质检测
  - 入门考验：对有潜力的人才设置入门考验
  - 晋升机制：通过考验的人才可晋升为内门弟子，成为AI控制的核心角色

- **宗门发展**：
  - 宗门等级：从低级宗门逐步发展为高级宗门，影响人口上限和资源产出
  - 领地扩张：占领更多领地，增加人口数量和资源产出
  - 势力关系：与其他宗门建立友好或敌对关系，影响贸易和战争
  - 传承系统：宗门功法和秘密的传承机制，确保宗门延续

#### 2.1.4 试炼系统
- **试炼系统概述**：
  - 试炼系统是一个多层次的游戏系统，为AI角色提供获取高级材料道具的主要途径
  - 系统支持三种主要试炼类型：小区域随时试炼、大区域高级试炼、宗门定期试炼
  - **核心定位**：通过占领区域解锁试炼机会，产出道具系统中的高级材料道具

- **试炼层次结构**：
  - **小区域随时试炼**：
    - **随时可进行**：任何已占领的小区域都可以随时进行试炼
    - **基础材料产出**：主要产出基础的高级材料道具
    - **低风险低收益**：风险较低，适合日常材料收集
    - **无冷却时间**：可以连续进行，但产出会随次数递减
  - **大区域高级试炼**：
    - **解锁条件**：需要完全占领整个大区域才能解锁
    - **高级材料产出**：产出特定的大区域特色高级材料道具
    - **高风险高收益**：难度较高，但产出价值更高
    - **冷却时间**：每次试炼后有较长的冷却时间
  - **宗门定期试炼**：
    - **定期举办**：宗门可定期组织大型试炼活动
    - **特色材料产出**：产出宗门特有的高级材料道具
    - **集体参与**：多个AI角色可同时参与，提升成功率
    - **宗门声望**：成功举办可提升宗门声望和凝聚力

- **小区域随时试炼**：
  - **灵草采集试炼**：
    - **试炼区域**：任何已占领的灵草生长区域
    - **产出材料**：基础灵草、灵药种子、普通灵材
    - **试炼难度**：低，需要炼气期以上修为
    - **获取概率**：每次试炼有60%概率获得5-15单位基础材料
    - **特色**：无冷却时间，可连续进行，适合日常材料收集
  - **矿石开采试炼**：
    - **试炼区域**：任何已占领的矿脉区域
    - **产出材料**：普通矿石、精铁、玄铁
    - **试炼难度**：中等，需要筑基期以上修为
    - **获取概率**：每次试炼有50%概率获得3-10单位矿石材料
    - **特色**：需要采矿技能，产出效率受技能等级影响
  - **妖兽狩猎试炼**：
    - **试炼区域**：任何已占领的妖兽栖息地
    - **产出材料**：妖兽皮毛、兽骨、兽血
    - **试炼难度**：中等，需要战斗功法支持
    - **获取概率**：每次试炼有40%概率获得2-8单位妖兽材料
    - **特色**：需要战斗技能，有受伤风险

- **大区域高级试炼**：
  - **解锁机制**：
    - **完全占领要求**：需要占领大区域内所有小区域
    - **解锁奖励**：解锁1-3个特色高级试炼
    - **区域特色**：不同大区域解锁不同的特色试炼
  - **灵脉区域高级试炼**：
    - **解锁条件**：完全占领灵脉大区域
    - **产出材料**：灵脉精华、灵晶、高级灵草
    - **试炼难度**：高，需要金丹期以上修为
    - **获取概率**：每次试炼有30%概率获得1-5单位高级材料
    - **特色**：产出材料品质高，可用于炼制高级丹药
  - **古战场区域高级试炼**：
    - **解锁条件**：完全占领古战场大区域
    - **产出材料**：古兵残片、战魂精华、古功法秘籍
    - **试炼难度**：极高，需要元婴期以上修为
    - **获取概率**：每次试炼有20%概率获得1-3单位稀有材料
    - **特色**：有概率获得古代功法和装备图纸
  - **秘境区域高级试炼**：
    - **解锁条件**：完全占领秘境大区域
    - **产出材料**：秘境灵果、上古灵材、仙草种子
    - **试炼难度**：极高，需要元婴期圆满修为
    - **获取概率**：每次试炼有15%概率获得1-2单位传说材料
    - **特色**：产出材料极为稀有，价值极高

- **宗门定期试炼**：
  - **举办机制**：
    - **举办周期**：每季度或每年可举办一次
    - **参与要求**：宗门内所有符合条件的AI角色均可参与
    - **举办成本**：需要消耗宗门资源和声望
  - **宗门大比试炼**：
    - **试炼类型**：宗门内部比武和技艺展示
    - **产出材料**：宗门特色材料、功法传承道具
    - **试炼难度**：根据参与者实力动态调整
    - **获取概率**：优胜者有80%概率获得特色材料
    - **特色**：提升宗门凝聚力和弟子实力
  - **联合秘境试炼**：
    - **试炼类型**：与其他宗门联合探索秘境
    - **产出材料**：秘境特有材料、稀有功法秘籍
    - **试炼难度**：高，需要团队协作
    - **获取概率**：成功探索有50%概率获得稀有材料
    - **特色**：提升宗门声望和外交关系
  - **传承试炼**：
    - **试炼类型**：宗门传承功法和技艺的试炼
    - **产出材料**：传承道具、功法升级材料
    - **试炼难度**：根据传承内容调整
    - **获取概率**：通过试炼可获得完整传承
    - **特色**：确保宗门技艺和功法的传承

- **试炼产出机制**：
  - **高级材料道具产出**：
    - 主要产出各种高级材料道具，这些道具属于道具系统的一部分
    - 高级材料道具可用于炼制高级丹药和打造高级装备
    - 产出概率与试炼难度相关，难度越高，产出概率越低但道具价值越高
    - 道具数量随机，通常在1-10单位之间，稀有道具数量较少
  - **低级装备道具产出**：
    - 有概率直接获得成品低级装备道具（凡器、法器级别）
    - 装备道具属性随机，可能附带特殊效果
    - 装备道具品质与试炼难度相关，高难度试炼可能产出更高品质装备
  - **功法秘籍道具产出**：
    - 有概率获得各种功法秘籍道具，这些道具属于道具系统的一部分
    - 功法秘籍道具可用于学习新的修炼、战斗或辅助功法
    - 产出概率与试炼类型相关，特定试炼类型产出对应功法秘籍
    - 秘籍品质与试炼难度相关，高难度试炼可能产出更高品质秘籍
  - **特殊奖励道具**：
    - 锻造图纸道具：可用于打造特定装备
    - 宗门贡献：完成试炼增加宗门贡献度
    - 修为提升：成功完成试炼可获得修为提升

- **试炼材料分类系统**：
  - **基础材料类**（小区域随时试炼产出）：
    - **灵草材料**：基础灵草、灵药种子、普通灵材
      - 用途：炼制基础丹药、制作低级符箓
      - 价值：10-50块灵石/单位
    - **矿石材料**：普通矿石、精铁、玄铁
      - 用途：打造凡器、法器级别装备
      - 价值：20-100块灵石/单位
    - **妖兽材料**：妖兽皮毛、兽骨、兽血
      - 用途：制作符箓、炼制特殊丹药
      - 价值：30-150块灵石/单位
  - **高级材料类**（大区域高级试炼产出）：
    - **灵脉材料**：灵脉精华、灵晶、高级灵草
      - 用途：炼制高级丹药、打造灵器
      - 价值：500-2000块灵石/单位
    - **古战场材料**：古兵残片、战魂精华、古功法秘籍
      - 用途：修复古宝、炼制特殊丹药
      - 价值：800-3000块灵石/单位
    - **秘境材料**：秘境灵果、上古灵材、仙草种子
      - 用途：炼制仙丹、打造仙器
      - 价值：2000-10000块灵石/单位
  - **特色材料类**（宗门定期试炼产出）：
    - **宗门特色材料**：宗门特有灵材、传承道具
      - 用途：炼制宗门特色丹药、打造传承装备
      - 价值：1000-5000块灵石/单位
    - **联合秘境材料**：秘境特有材料、稀有功法秘籍
      - 用途：提升宗门实力、建立外交关系
      - 价值：1500-6000块灵石/单位
    - **传承材料**：传承道具、功法升级材料
      - 用途：确保宗门技艺传承、提升功法境界
      - 价值：非卖品，仅限宗门内部使用

- **试炼参与机制**：
  - **修为要求**：不同试炼有最低修为限制，确保角色具备相应实力
  - **宗门贡献**：需要宗门贡献达到一定值才能参与高级试炼
  - **试炼令牌**：部分试炼需要特殊令牌才能进入，令牌可通过任务或交易获得
  - **时间限制**：试炼有固定的开启时间，错过需等待下次开启
  - **队伍组建**：AI角色可组建试炼队伍，队伍成员互补可提高成功率

- **AI角色试炼交互**：
  - **试炼决策机制**：
    - **需求评估**：AI角色根据自身需求（如材料需求、装备需求、修为提升）评估是否参与试炼
    - **风险评估**：角色会评估试炼风险与自身实力的匹配度，避免参与过高风险试炼
    - **资源评估**：检查是否具备试炼所需道具、装备和灵石等资源
    - **优先级排序**：根据角色当前目标和宗门需求，对试炼参与进行优先级排序
  - **试炼准备行为**：
    - **道具准备**：自动准备试炼所需丹药、装备和消耗品
    - **技能准备**：检查并提升相关技能等级，如锻造技能、元素抗性等
    - **队伍协调**：与其他角色协商组建试炼队伍，分配角色职责
    - **情报收集**：收集试炼相关信息，制定应对策略
  - **试炼执行行为**：
    - **策略执行**：按照预定策略进行试炼，根据实际情况调整战术
    - **资源管理**：合理使用携带道具，避免资源浪费
    - **风险控制**：在危险情况下及时撤退，避免不必要的损失
    - **团队协作**：与队友配合，发挥各自优势
  - **试炼后行为**：
    - **成果分配**：根据贡献度公平分配试炼成果
    - **经验总结**：总结试炼经验，提升未来试炼成功率
    - **报告提交**：向宗门报告试炼结果，增加宗门贡献
    - **道具补充**：补充消耗的道具，为下次试炼做准备
  - **AI角色试炼偏好**：
    - **性格影响**：冒险性格角色更倾向于参与高风险试炼
    - **技能专长**：有锻造专长的角色偏好锻造试炼
    - **资源需求**：急需特定材料的角色会优先参与对应试炼
    - **宗门任务**：接受宗门任务的角色会按要求参与特定试炼

- **试炼风险与奖励平衡**：
  - **风险机制**：
    - **受伤风险**：试炼中可能受伤，影响修炼进度
      - 轻伤：恢复时间1-3天，修炼效率降低20%
      - 重伤：恢复时间7-15天，修炼效率降低50%
      - 致命伤：需要高级丹药救治，否则可能修为倒退
    - **死亡风险**：高难度试炼有死亡风险，角色可能永久损失
      - 低难度试炼：死亡概率<1%
      - 中难度试炼：死亡概率1-5%
      - 高难度试炼：死亡概率5-15%
      - 极高难度试炼：死亡概率15-30%
    - **道具损失**：试炼失败可能损失携带的道具
      - 基础道具损失率：10-30%
      - 高级道具损失率：30-60%
      - 稀有道具损失率：60-90%
    - **时间消耗**：试炼需要消耗大量时间，影响其他活动
      - 短时间试炼：1-3天
      - 中等试炼：3-7天
      - 长时间试炼：7-15天
      - 超长试炼：15-30天
    - **修为倒退风险**：严重失败可能导致修为倒退
      - 倒退幅度：1-3个小境界
      - 恢复难度：需要大量资源和时间
  - **奖励机制**：
    - **材料价值**：高级材料价值高，但获取难度大
      - 普通材料：价值50-200灵石/单位
      - 高级材料：价值200-1000灵石/单位
      - 稀有材料：价值1000-5000灵石/单位
      - 传说材料：价值5000-20000灵石/单位
    - **装备价值**：成品装备可直接使用或出售
      - 凡器：价值50-300灵石
      - 法器：价值300-1500灵石
      - 灵器：价值1500-5000灵石
      - 仙器：价值5000-20000灵石
      - **神器**：价值20000-100000灵石
    - **技能提升**：试炼过程可提升相关技能熟练度
      - 基础技能：每次试炼提升5-15点熟练度
      - 高级技能：每次试炼提升10-25点熟练度
      - 稀有技能：每次试炼提升15-40点熟练度
    - **声望提升**：成功完成高难度试炼可提升角色声望
      - 低难度试炼：声望+1-5
      - 中难度试炼：声望+5-15
      - 高难度试炼：声望+15-30
      - 极高难度试炼：声望+30-50
  - **平衡机制**：
    - **风险收益比**：高风险对应高收益，确保试炼参与价值
      - 低风险试炼：收益较低但稳定
      - 高风险试炼：收益高但波动大
    - **角色适应性**：不同角色对风险的承受能力不同
      - 冒险性格：偏好高风险高收益试炼
      - 保守性格：偏好低风险稳定收益试炼
    - **宗门策略**：宗门可根据发展阶段调整试炼策略
      - 发展期：优先低风险试炼，稳定获取基础材料
      - 扩张期：适当参与中风险试炼，获取高级材料
      - 成熟期：可尝试高风险试炼，追求稀有资源
    - **动态调整**：试炼难度和奖励会根据参与次数动态调整
      - 热门试炼：参与人数多，奖励可能降低
      - 冷门试炼：参与人数少，奖励可能提高

- **试炼与道具系统整合**：
  - **高级材料道具流通机制**：
    - 试炼产出的高级材料道具自动存入宗门仓库，作为道具系统的一部分
    - 这些材料道具可用于炼制丹药（如金丹草炼制金丹丸）或打造装备（如灵铁打造法器）
    - AI角色可根据需求从仓库获取材料道具用于炼制或交易
    - 材料道具价值受市场供需影响，稀有材料道具价格更高
  - **装备道具流通机制**：
    - 试炼产出的低级装备道具可直接分配给参与试炼的角色使用
    - 多余装备道具可存入仓库或通过道具系统交易
    - 装备道具品质与试炼难度相关，高难度试炼可能产出更高品质装备
  - **道具需求机制**：
    - 试炼前AI角色会自动准备所需道具（如疗伤丹、回气丹等消耗品道具）
    - 道具准备不足会影响试炼成功率和安全性
    - 道具消耗与试炼难度成正比，高难度试炼需要更多高级道具
  - **图纸道具传承机制**：
    - 试炼获得的锻造图纸道具可存入藏经阁供其他角色学习
    - 图纸道具使用需要相应技能等级，技能不足无法制作对应装备
    - 稀有图纸道具可作为宗门传承，提升宗门整体实力
  - **系统联动示例**：
    - 长老张三参与灵铁矿脉试炼，获得5单位灵铁道具
    - 灵铁道具存入仓库，炼器长老李四可用其打造法器道具
    - 李四成功打造法器道具后，可分配给内门弟子使用或出售
    - 出售所得灵石可用于购买更多试炼所需消耗品道具

#### 2.1.5 功法系统

功法系统是宗门传承和角色修炼的核心系统，包含各种修炼法门和战斗技能，支持功法获取、学习、传承、升级等完整生命周期。

**功法分类体系**

| 功法类别 | 子类别 | 主要功能 | 学习要求 | 传承方式 | 价值范围 |
|---------|-------|---------|---------|---------|---------|
| **修炼功法** | 基础修炼功法 | 提升修为境界 | 炼气期 | 藏经阁学习 | 100-500灵石 |
| | 中级修炼功法 | 突破境界瓶颈 | 筑基期 | 长老传授 | 500-2000灵石 |
| | 高级修炼功法 | 提升修为品质 | 金丹期以上 | 掌门传承 | 2000-8000灵石 |
| **战斗功法** | 剑法类 | 增强攻击能力 | 基础要求 | 剑道长老传授 | 200-3000灵石 |
| | 法术类 | 元素攻击技能 | 灵根要求 | 法术长老传授 | 300-5000灵石 |
| | 身法类 | 提升闪避移动 | 基础要求 | 身法长老传授 | 150-2000灵石 |
| **辅助功法** | 炼丹功法 | 提升炼丹技能 | 火灵根/天赋 | 炼丹长老传授 | 500-4000灵石 |
| | 炼器功法 | 提升炼器技能 | 金灵根/天赋 | 炼器长老传授 | 500-4000灵石 |
| | 阵法功法 | 提升阵法技能 | 悟性要求 | 阵法长老传授 | 600-5000灵石 |

**修炼功法详细规格**

| 功法名称 | 品级 | 适用境界 | 修炼效果 | 学习要求 | 传承方式 |
|---------|-----|---------|---------|---------|---------|
| **引气诀** | 基础 | 炼气期 | 灵气吸收+10%，突破+5% | 无特殊要求 | 藏经阁学习 |
| **凝气诀** | 基础 | 炼气期 | 灵气凝练+15%，突破+8% | 炼气三层，根骨中等 | 内门弟子申请 |
| **筑基心法** | 中级 | 筑基期 | 筑基成功率+15%，道基稳固+20% | 炼气圆满，根骨上等 | 亲传弟子学习 |
| **金丹大道** | 中级 | 金丹期 | 金丹成功率+12%，品质+15% | 筑基圆满，悟性上等 | 核心长老传授 |
| **元婴真解** | 高级 | 元婴期 | 元婴成功率+10%，品质+20% | 金丹圆满，福缘上等 | 掌门/太上长老传承 |
| **化神天书** | 顶级 | 化神期 | 化神成功率+8%，品质+25% | 元婴圆满，特殊机缘 | 掌门传承 |

**战斗功法详细规格**

| 功法名称 | 类别 | 战斗效果 | 学习要求 | 传承方式 | 冷却时间 |
|---------|-----|---------|---------|---------|---------|
| **基础剑诀** | 剑法 | 威力+10%，命中+5% | 无特殊要求 | 基础传承 | 无 |
| **青莲剑诀** | 剑法 | 威力+25%，附带剑气 | 筑基期，剑道天赋 | 剑道长老传授 | 30分钟 |
| **火球术** | 法术 | 火系伤害+15%，低消耗 | 火灵根/天赋 | 法术长老传授 | 15分钟 |
| **冰封术** | 法术 | 冰系伤害+30%，冰冻效果 | 冰灵根，筑基期 | 冰系长老传授 | 45分钟 |
| **轻身术** | 身法 | 闪避+10%，移动+15% | 无特殊要求 | 基础传承 | 无 |
| **幻影步** | 身法 | 闪避+20%，制造幻影 | 筑基期，身法天赋 | 身法长老传授 | 1小时 |

**功法获取机制**

| 获取方式 | 获取概率 | 功法品级 | 获取条件 | 特色 |
|---------|---------|---------|---------|------|
| **藏经阁学习** | 100% | 基础-中级 | 宗门贡献 | 稳定可靠 |
| **长老传授** | 80-90% | 中级-高级 | 师徒关系 | 传承加成 |
| **掌门传承** | 70-85% | 高级-顶级 | 核心弟子 | 品质保证 |
| **试炼奖励** | 10-30% | 随机品级 | 试炼完成 | 稀有功法 |
| **交易获取** | 100% | 基础-高级 | 灵石充足 | 快速获取 |
| **遗迹探索** | 5-15% | 高级-顶级 | 探索成功 | 失传功法 |
| **奇遇事件** | 1-5% | 随机品级 | 随机触发 | 特殊功法 |

**功法学习机制**

| 学习阶段 | 持续时间 | 掌握程度 | 效果加成 | 可传授 |
|---------|---------|---------|---------|--------|
| **领悟阶段** | 1-3天 | 初步理解 | 效果+20% | 否 |
| **修炼阶段** | 1-2周 | 基本掌握 | 效果+50% | 否 |
| **熟练阶段** | 1-3个月 | 熟练掌握 | 效果+80% | 基础功法 |
| **精通阶段** | 半年以上 | 完全精通 | 效果+100% | 所有功法 |

**功法传承机制**

| 传承关系 | 传承成功率 | 传承效果 | 传承限制 | 冷却时间 |
|---------|---------|---------|---------|---------|
| **长老→亲传弟子** | 80-95% | 熟练度+30% | 功法品级限制 | 1个月 |
| **亲传弟子→内门弟子** | 60-80% | 熟练度+15% | 基础功法 | 2周 |
| **掌门→核心弟子** | 70-90% | 熟练度+25% | 忠诚度要求 | 3个月 |
| **藏经阁学习** | 100% | 熟练度+0% | 权限要求 | 无 |

**功法与AI角色关联**

| 角色层级 | 功法选择优先级 | 可传授功法 | 学习权限 | 传承权限 |
|---------|---------------|-----------|---------|---------|
| **掌门** | 修炼功法 > 战斗功法 > 辅助功法 | 所有功法 | 无限制 | 核心弟子 |
| **长老** | 修炼功法 > 专业功法 > 战斗功法 | 高级以下 | 高级功法 | 亲传弟子 |
| **亲传弟子** | 修炼功法 > 战斗功法 | 基础功法 | 中级功法 | 内门弟子 |
| **内门弟子** | 战斗功法 > 修炼功法 | 无 | 基础功法 | 无 |

**功法系统与道具系统整合**
- **功法秘籍道具**：功法以秘籍道具形式存在，可交易和传承
- **功法学习道具**：部分功法需要特殊道具辅助学习
- **功法升级道具**：高级功法升级可能需要稀有材料道具
- **功法传承道具**：功法传承可使用特殊传承道具提高成功率

#### 2.1.6 玩家交互系统
- **命令输入**：
  - 支持自然语言命令输入（如"查看宗门状态"、"让张三去炼丹"）
  - 提供命令补全和提示功能
  - 支持快捷键操作常用命令
- **状态查询**：
  - 宗门状态查询：查看宗门等级、资源、设施等信息
  - 角色信息查询：查看单个或多个角色的详细信息
  - 世界状态查询：查看当前时间、天气、事件等
- **决策干预**：
  - 重要决策投票：玩家可以对宗门的重要决策进行投票
  - 直接命令：对特定角色下达直接命令
  - 政策制定：制定宗门政策，影响宗门发展方向
- **剧情交互**：
  - 对话系统：与游戏角色进行文字对话
  - 选择系统：在关键剧情节点做出选择
  - 任务系统：接受和完成各种任务
- **界面设计**：
  - 简洁的文字界面，支持分屏显示
  - 实时状态显示：当前时间、天气、玩家角色状态等
  - 历史记录：保存游戏历史记录，支持回溯查看

#### 2.1.7 地图系统

地图系统管理游戏世界的区域划分、占领机制和资源产出，采用分层结构设计，支持宗门的扩张和发展。

**地图分层结构**

| 层级 | 区域类型 | 数量范围 | 主要功能 | 控制机制 |
|-----|---------|---------|---------|---------|
| **大区域** | 灵脉区域、古战场、秘境等 | 5-10个 | 提供高级试炼和特色资源 | 完全占领解锁高级试炼 |
| **小区域** | 灵草区、矿脉区、妖兽区等 | 20-50个 | 提供基础试炼和日常资源 | 随时可占领和试炼 |
| **宗门领地** | 宗门核心区域 | 1个 | 宗门设施和核心管理 | 初始拥有，可升级扩建 |

**大区域类型与特性**

| 区域名称 | 区域类型 | 资源产出 | 占领难度 | 完全占领加成 |
|---------|---------|---------|---------|-------------|
| **灵脉区域** | 灵气充沛 | 灵脉精华、灵晶、高级灵草 | 高 | 灵气浓度+30%，修炼速度+20% |
| **古战场区域** | 历史遗迹 | 古兵残片、战魂精华、古功法 | 极高 | 战斗经验+25%，功法领悟+15% |
| **秘境区域** | 神秘空间 | 秘境灵果、上古灵材、仙草种子 | 极高 | 奇遇概率+20%，稀有材料+15% |
| **灵草区域** | 植被丰富 | 基础灵草、灵药种子、普通药材 | 中 | 炼丹成功率+15%，药材产量+25% |
| **矿脉区域** | 矿产丰富 | 普通矿石、精铁、玄铁、灵石 | 中 | 炼器成功率+15%，矿石产量+25% |

**小区域类型与特性**

| 区域名称 | 区域类型 | 资源产出 | 试炼类型 | 占领条件 |
|---------|---------|---------|---------|---------|
| **灵草生长区** | 灵草生长 | 基础灵草、灵药种子 | 灵草采集试炼 | 炼气期即可占领 |
| **矿脉开采区** | 矿石开采 | 普通矿石、精铁、玄铁 | 矿石开采试炼 | 筑基期可占领 |
| **妖兽栖息地** | 妖兽活动 | 妖兽皮毛、兽骨、兽血 | 妖兽狩猎试炼 | 筑基期可占领 |
| **灵泉区域** | 灵气聚集 | 灵泉水、灵气结晶 | 灵泉修炼试炼 | 炼气期即可占领 |
| **灵木林区** | 灵木生长 | 灵木、灵木种子、木材 | 灵木采集试炼 | 炼气期即可占领 |

**区域占领机制**

| 占领阶段 | 控制程度 | 资源产出 | 试炼权限 | 占领成本 |
|---------|---------|---------|---------|---------|
| **初步占领** | 0-30% | 基础资源10-30% | 无试炼权限 | 低 |
| **稳定控制** | 30-70% | 基础资源30-70% | 基础试炼 | 中 |
| **完全控制** | 70-100% | 基础资源70-100% | 所有试炼 | 高 |
| **完全占领** | 100% | 全部资源+加成 | 高级试炼解锁 | 极高 |

**区域资源产出机制**

| 资源类型 | 产出区域 | 基础产出量 | 完全占领加成 | 产出周期 |
|---------|---------|---------|-------------|---------|
| **基础资源** | 所有小区域 | 根据区域类型 | 产量+25-50% | 月度 |
| **高级材料** | 大区域试炼 | 概率获得 | 概率+10-20% | 季度 |
| **凡俗百姓** | 人口区域 | 根据控制度 | 人口+20-40% | 年度 |
| **特殊资源** | 特色区域 | 稀有产出 | 产出+15-30% | 年度 |

**区域加成系统**

| 加成类型 | 触发条件 | 加成效果 | 持续时间 | 叠加规则 |
|---------|---------|---------|---------|---------|
| **完全占领加成** | 大区域100%控制 | 区域特色加成 | 永久 | 可叠加 |
| **相邻区域加成** | 相邻区域同属 | 资源产出+5% | 永久 | 最多+15% |
| **区域连锁加成** | 同类型区域群 | 特殊效果加成 | 永久 | 类型相关 |
| **季节性加成** | 季节变化 | 季节性产出变化 | 季度 | 循环生效 |

**区域扩张策略**

| 扩张策略 | 适用阶段 | 资源需求 | 风险等级 | 预期收益 |
|---------|---------|---------|---------|---------|
| **稳健扩张** | 初期 | 低 | 低 | 稳定增长 |
| **重点突破** | 中期 | 中 | 中 | 特色资源 |
| **全面扩张** | 后期 | 高 | 高 | 最大收益 |
| **战略扩张** | 任何阶段 | 极高 | 极高 | 关键优势 |

**地图系统与试炼系统整合**
- **区域试炼解锁**：占领程度决定试炼类型和难度
- **资源产出关联**：试炼产出与区域资源类型直接相关
- **占领加成影响**：完全占领区域提供试炼成功率加成
- **扩张策略协调**：试炼需求影响区域扩张优先级

### 2.2 非功能需求

#### 2.2.1 性能要求
- 游戏运行流畅，无明显卡顿
- 支持同时运行100+ AI角色

#### 2.2.2 可扩展性
- 支持添加新的角色类型、行为和事件
- 支持扩展宗门的设施和资源类型

#### 2.2.3 可维护性
- 代码结构清晰，便于维护和扩展
- 基于ECS框架，组件和系统分离，易于测试

## 3. 技术架构

### 3.1 ECS框架使用
本项目将基于现有的lko-ecs4框架实现，充分利用其组件化和数据驱动的特性，实现游戏世界的高效管理和AI角色的智能行为。

#### 3.1.1 核心组件使用

| 组件名称 | 功能描述 | 项目应用 |
|---------|---------|---------|
| **World** | 游戏世界的核心容器，管理所有实体和系统 | 作为游戏的主容器，存储所有游戏对象和系统 |
| **Entity** | 游戏中的所有对象（角色、资源、设施等）都是实体 | 表示游戏中的角色、资源、设施、事件等所有对象 |
| **Component** | 实体的属性和数据，如角色的姓名、年龄、修为等 | 为实体添加各种属性和数据，如Named、Age、Cultivation等 |
| **Archetype** | 实体类型的集合，定义实体的组件组合 | 定义不同类型的实体（如AI角色、资源、设施等）及其组件组合 |
| **Service** | 处理实体的创建、更新和销毁等操作 | 实现各种游戏系统，如角色管理、资源管理、世界更新等 |
| **Relation** | 实体之间的关系 | 表示角色之间的师徒关系、宗门与资源的所属关系等 |
| **Query** | 实体查询系统 | 高效查询符合特定条件的实体，如查询所有炼丹师角色 |

#### 3.1.2 ECS框架优势
- **性能优化**：数据集中存储，减少缓存失效，提高性能
- **可扩展性**：组件化设计，易于添加新功能和修改现有功能
- **灵活性**：实体可以动态添加和移除组件，改变实体类型
- **可维护性**：系统和数据分离，逻辑清晰，易于维护

### 3.2 主要组件设计

#### 3.2.1 角色相关组件
- `Character`：角色标签组件（核心组件，无后缀）
- `Named`：角色姓名信息
- `Age`：角色年龄信息
- `Cultivation`：角色修为信息
- `Talent`：角色资质信息
- `Personality`：角色性格信息
- `MemberData`：角色在宗门中的身份、贡献度等信息
- `ResourceConsumption`：角色资源消耗情况（修炼消耗、管理消耗等）
- `Status`：角色当前状态（满意度、忠诚度等）
- `Attribute`：角色属性系统
- `Level`：角色等级信息

#### 3.2.2 宗门相关组件
- `Sect`：宗门标签组件（核心组件，无后缀）
- `SectConfig`：宗门配置信息
- `SectMoney`：宗门资金信息
- `SectReputation`：宗门声望信息
- `SectResource`：宗门资源信息（各类资源的数量和状态）
- `Building`：设施标签组件（核心组件，无后缀）
- `BuildingTypeComponent`：设施类型信息（类型包装器，带Component后缀）
- `BuildingEfficiency`：设施效率信息
- `BuildingCapacity`：设施容量信息
- `SectStructure`：宗门结构信息
- `ResourceAllocation`：资源分配策略和记录
- `Inventory`：资源仓库信息（容量、损耗率等）
- `MemberQuota`：成员配额信息

#### 3.2.3 行为相关组件
- `Action`：角色当前行为
- `Goal`：角色目标
- `Decision`：角色决策逻辑
- `Command`：AI管理层下达的指令
- `Goap`：角色目标导向决策系统
- `Countdown`：行为倒计时信息
- `SectTask`：任务标签组件
- `TaskProgress`：任务进度信息
- `TaskStatus`：任务状态信息
- `TaskTypeComponent`：任务类型信息

#### 3.2.4 人口资源组件
- `Population`：人口资源信息（数量、质量、增长等）
- `Production`：资源产出信息（产出率、设施加成等）
- `MaintenanceCost`：资源维持成本
- `PopulationContribution`：人口贡献度信息
- `PopulationMoney`：人口相关资金流动信息
- `PopulationResource`：人口相关资源信息

#### 3.2.5 系统互动组件
- `Satisfaction`：人口满意度信息
- `Growth`：人口增长信息
- `OwnedBy`：所属关系信息
- `UsedBy`：使用关系信息
- `Description`：描述信息
- `Level`：等级信息

#### 3.2.6 物品系统组件
- `Item`：物品标签组件
- `Stackable`：可堆叠物品标签组件
- `Amount`：物品数量信息
- `UnitPrice`：物品单价信息

#### 3.2.7 功法系统组件
- `Technique`：功法标签组件（核心组件，无后缀）
- `TechniqueNameComponent`：功法名称信息
- `TechniqueGradeComponent`：功法品级信息（凡级、灵级、仙级等）
- `TechniqueTypeComponent`：功法类型信息（修炼功法、战斗功法、辅助功法）
- `TechniqueEffectComponent`：功法效果信息（修炼加成、战斗加成等）
- `TechniqueRequirementComponent`：功法学习要求（修为要求、资质要求等）
- `TechniqueLearningComponent`：功法学习进度信息
- `TechniqueMasteryComponent`：功法掌握程度信息（入门、熟练、精通、大成）
- `TechniqueInheritanceComponent`：功法传承信息（可传授对象、传承冷却等）
- `TechniqueSlotComponent`：角色功法栏位信息（主修功法、辅修功法等）
- `TechniqueCompatibilityComponent`：功法兼容性信息（功法搭配效果）
- `TechniqueEvolutionComponent`：功法进化信息（功法可升级路径）
- `TechniqueManual`：功法秘籍道具组件
- `TechniqueManualContentComponent`：功法秘籍内容信息
- `TechniqueManualUsageComponent`：功法秘籍使用限制信息

#### 3.2.8 试炼系统组件
- `Trial`：试炼标签组件（核心组件，无后缀）
- `TrialTypeComponent`：试炼类型信息（类型包装器，带Component后缀）
- `TrialDifficulty`：试炼难度信息
- `TrialReward`：试炼奖励信息
- `TrialRisk`：试炼风险信息
- `TrialParticipant`：试炼参与者信息
- `TrialRegionComponent`：试炼区域信息（关联地图区域）
- `TrialUnlockConditionComponent`：试炼解锁条件信息
- `TrialCooldownComponent`：试炼冷却时间信息
- `TrialMaterialOutputComponent`：试炼材料产出信息
- `TrialEquipmentOutputComponent`：试炼装备产出信息
- `TrialTechniqueOutputComponent`：试炼功法产出信息
- `TrialSuccessRateComponent`：试炼成功率信息
- `TrialTeamComponent`：试炼队伍信息
- `TrialProgressComponent`：试炼进度信息
- `TrialResultComponent`：试炼结果信息
- `TrialMaterialCategoryComponent`：试炼材料分类信息
- `TrialSpecialRewardComponent`：试炼特殊奖励信息
- `TrialContributionComponent`：试炼贡献度信息
- `TrialPreparationComponent`：试炼准备状态信息
- `TrialStrategyComponent`：试炼策略信息
- `TrialProgress`：试炼进度信息
- `TrialResult`：试炼结果信息
- `TrialMaterialDrop`：试炼材料掉落信息
- `TrialEquipmentDrop`：试炼装备掉落信息

#### 3.2.9 市场系统组件
- `Market`：市场标签组件
- `ConsignmentOrder`：寄售订单标签组件
- `AcquisitionOrder`：收购订单标签组件
- `ConsignmentItemData`：寄售物品数据（单价）
- `AcquisitionItemData`：收购物品数据（数量、单价）

#### 3.2.9 地图系统组件
- `Region`：大区域标签组件
- `SubRegion`：小区域标签组件
- `RegionTypeComponent`：区域类型信息（资源类型、地形等）
- `Owner`：区域所有者信息
- `ControlLevel`：区域控制程度（0-100%）
- `ResourceOutput`：区域资源产出信息
- `OccupationBonus`：区域占领加成信息
- `RegionRelationship`：区域间相邻关系信息

### 3.3 主要系统设计

#### 3.3.1 世界系统
- 管理游戏世界的时间、天气和事件
- 定期更新世界状态
- 触发资源消耗和产出的时间节点
- 监控系统间互动关系和平衡

#### 3.3.2 AI角色系统
- 控制AI角色的行为和决策
- 处理角色的修炼、工作和社交等行为
- 管理AI管理层的工资发放和资源消耗（职务工资、修炼、管理、社交消耗）
- 实现决策逻辑，根据资源状况调整管理策略
- 基于GOAP（Goal-Oriented Action Planning）算法实现角色智能规划

#### 3.3.3 宗门管理系统
- 管理宗门的资源和设施
- 处理宗门的发展和扩张
- **SectService**：宗门核心服务，管理宗门创建、升级和基本信息
- **SectResourceService**：管理宗门资源的获取、消耗、存储和分配
- **SectMemberService**：管理宗门成员，包括成员角色、贡献度和权限
- **BuildingService**：管理宗门设施的建设、维护、升级和运行
- **TaskService**：管理宗门任务系统，包括任务发布、接受和完成

#### 3.3.4 资源与物品系统
- **ItemService**：管理游戏中的各类物品，包括创建、获取和使用
- **InventoryService**：管理角色和宗门的物品背包
- **MoneyService**：管理游戏中的货币系统
- **AlchemyService**：管理炼丹系统，包括配方和炼制过程
- **TechniqueService**：管理功法系统，包括学习、修炼和使用

#### 3.3.5 任务与福利系统
- **TaskService**：管理任务的发布、接受、进度跟踪和完成
- **WelfareService**：管理宗门福利系统，包括福利发放和领取

#### 3.3.6 玩家交互系统
- 处理玩家的命令输入
- 提供游戏状态的文字描述
- 展示资源流动和消耗情况
- 支持玩家查看系统互动关系和平衡

#### 3.3.7 资源消耗与产出系统
- 实现资源消耗模型，计算各类资源的消耗
- 管理资源产出机制，包括人口产出和设施加成
- 处理资源分配逻辑和优先级
- 监控资源平衡，触发相应事件

#### 3.3.8 系统互动管理系统
- 管理系统间的互动关系
- 计算设施对资源产出和消耗的效率加成
- 处理AI管理层指令对其他系统的影响
- 监控人口满意度对资源产出的影响
- 协调地图系统与其他系统的互动：
  - **地图系统 ↔ 宗门系统**：宗门可以占领和管理地图区域，地图区域影响宗门资源获取和发展空间
  - **地图系统 ↔ 资源系统**：不同区域产出不同资源，完全占领区域提供资源加成
  - **地图系统 ↔ AI角色系统**：AI角色可以被派遣去占领和管理区域，区域状态影响角色行为
  - **地图系统 ↔ 设施系统**：可以在占领的区域建造设施，设施提升区域控制度和资源产出
  - **地图系统 ↔ 资源分配系统**：区域占领和管理需要分配资源，区域产出的资源纳入资源分配系统

#### 3.3.9 地图系统
- **区域分层结构**：
  - **大区域（Region）**：
    - **类型**：山脉、森林、平原、河流、沙漠、海洋、湖泊、高原、峡谷、沼泽等
    - **属性**：
      - 区域面积（影响包含小区域数量）
      - 地形复杂度（影响占领难度和资源产出多样性）
      - 资源丰富度（影响整体资源产出水平）
      - 战略价值（影响区域争夺激烈程度）
      - 环境风险（如自然灾害发生概率）
    - **示例**："万仞山脉"（大型山脉区域）、"青灵森林"（茂密森林区域）
  
  - **小区域（SubRegion）**：
    - **类型**：
      - **资源型**：矿脉（铁矿、铜矿、灵石矿等）、灵草田、木材产地、渔场
      - **居民型**：村庄、城镇、部落、集市
      - **地形型**：山峰、山谷、草原、河流段、湖泊、洞穴
      - **特殊型**：秘境入口、古迹遗址、天然阵法节点
    - **属性**：
      - 具体位置（在大区域内的坐标）
      - 面积大小（影响资源产出量）
      - 地形特征（影响占领和建设难度）
      - 初始资源量（决定产出潜力）
      - 可建设类型（限制可建造的设施类型）
    - **示例**：
      - 万仞山脉内的"玄铁矿脉"（资源型小区域）
      - 青灵森林内的"青木村"（居民型小区域）
  
  - **层级关系**：
    - 每个大区域包含3-15个小区域，数量取决于大区域面积和地形复杂度
    - 小区域只能属于一个大区域，形成树形层级结构
    - 相邻大区域内的小区域可能存在地理连接
    - 支持大区域与小区域的层级管理和可视化
  
  - **区域命名规则**：
    - 大区域：采用"形容词+地理类型"的命名方式（如"万仞山脉"、"青灵森林"）
    - 小区域：采用"特征+类型"的命名方式（如"玄铁矿脉"、"青木村"）

- **区域占领机制**：
  - **占领方式**：
    - **武力占领**：派遣弟子（特别是内门以上弟子）直接占领，适合无主或敌对区域
    - **建设占领**：在区域内建设设施（如哨塔、据点）逐步建立控制，适合中立区域
    - **外交占领**：通过外交手段（如联盟、附庸）获得区域控制权，适合友好势力
  
  - **占领条件**：
    - 宗门等级达到最低要求（如小型宗门只能占领基础区域）
    - 拥有足够的资源和弟子
    - 未处于战争或制裁状态
  
  - **资源消耗**（武力占领为例）：
    - **弟子消耗**：根据区域规模和地形复杂度，需要派遣1-10名弟子
    - **资源消耗**：
      - 基础消耗：100-500单位灵石
      - 地形加成：复杂地形（如山脉、沼泽）增加50-100%消耗
      - 抵抗加成：有抵抗势力时增加100-200%消耗
    - **维护消耗**：占领后每月消耗5-20单位灵石（根据区域类型）
  
  - **时间计算**：
    - 基础占领时间：3-10天
    - 弟子实力加成：高修为弟子可减少20-50%时间
    - 地形复杂度加成：复杂地形增加30-100%时间
    - 设施加成：已建设的临近设施可减少10-30%时间
  
  - **占领过程**：
    - 阶段1：探索（10-30%进度）：了解区域情况，清除小型抵抗
    - 阶段2：建立据点（30-70%进度）：建设临时设施，巩固初步控制
    - 阶段3：完全控制（70-100%进度）：建立完整管理体系，实现稳定控制
  
  - **区域争夺规则**：
    - **争夺条件**：
      - 目标区域控制度低于70%
      - 争夺方宗门等级不低于被争夺方
      - 拥有足够的资源和兵力
    - **争夺过程**：
      - 宣战阶段：向目标区域所有者宣战（消耗声望）
      - 争夺阶段：双方派遣弟子或使用特殊手段争夺控制度
      - 结算阶段：持续一定时间后，控制度高的一方获得胜利
    - **争夺后果**：
      - 胜利方获得区域控制权
      - 失败方失去区域，损失部分资源和弟子
      - 双方声望根据争夺结果变化
    - **特殊情况**：
      - 区域控制度低于30%时，自动进入"动荡状态"，可被任意宗门争夺
      - 宗主亲自参与争夺可大幅提高成功率，但风险也更高
  
  - **占领奖励**：
    - 获得区域的资源产出权（包括基础资源和高级资源）
    - 获得区域内的凡俗百姓作为宗门人口资源
    - 增加宗门领地面积
    - 提高宗门声望
    - 解锁特殊功能或任务

- **区域控制度**：
  - 每个小区域有控制度值（0-100%）
  - 控制度影响资源产出效率和区域稳定性
  - 控制度低于一定阈值时，区域可能叛乱或被争夺
  - 可以通过派遣更多弟子或建设特殊设施提升控制度

- **完全占领加成**：
  - **触发条件**：
    - 完全占领一个大区域内的所有小区域
    - 每个小区域的控制度不低于70%
    - 维持时间超过7天
  
  - **加成类型与效果**：
    - **资源产出加成**：
      - 基础资源产出增加15-30%（根据区域类型）
      - 高级资源（如灵石、灵草）产出增加20-40%
      - 资源种类多样性提高（解锁新资源类型）
    
    - **设施效率加成**：
      - 区域内所有设施效率提升10-25%
      - 设施建设和升级时间减少15-30%
      - 设施维护成本降低10-20%
    
    - **弟子相关加成**：
      - 区域内弟子修炼速度提高15-30%
      - 弟子突破概率增加5-15%
      - 弟子忠诚度提升5-10%
    
    - **战略加成**：
      - 宗门声望每月增加2-5点
      - 区域防御能力提升20-50%
      - 对相邻区域的占领难度降低15-30%
    
    - **特殊区域加成**：
      - 山脉区域：弟子力量属性提升
      - 森林区域：弟子敏捷属性提升
      - 平原区域：弟子耐力属性提升
      - 河流区域：资源运输效率提升
  
  - **加成计算方式**：
    - 基础加成 = 区域基础价值 × 区域面积系数
    - 维持加成 = 基础加成 × 维持时间系数（最高1.5倍）
    - 最终加成 = 维持加成 × 宗门等级系数
    - **示例**：
      - 万仞山脉（大区域）完全占领基础加成为20%
      - 维持30天后维持时间系数为1.3
      - 中型宗门等级系数为1.2
      - 最终资源产出加成 = 20% × 1.3 × 1.2 = 31.2%
  
  - **维持机制**：
    - **维持条件**：
      - 所有小区域控制度不低于60%
      - 每月消耗额外资源（基础消耗的15-25%）
      - 至少派遣1名弟子长期驻守
    
    - **维持时间**：
      - 初始维持时间为30天
      - 可通过消耗额外资源延长维持时间
      - 每延长10天需要消耗基础维持资源的50%
    
    - **衰减机制**：
      - 当任意小区域控制度低于60%时，加成开始衰减
      - 每天衰减2-5%，直到所有区域恢复到60%控制度
      - 衰减期间加成效果按当前值计算
  
  - **失去完全占领状态**：
    - **触发条件**：
      - 任意小区域被其他宗门占领
      - 超过3个小区域控制度低于50%
      - 未按时支付维持资源
    
    - **后果**：
      - 立即失去所有完全占领加成
      - 宗门声望下降5-20点
      - 区域内设施效率临时降低10-20%
      - 重新获得完全占领状态需要重新计算维持时间
  
  - **多区域叠加效果**：
    - 完全占领多个相邻大区域可获得额外的"区域集群加成"
    - 每个额外相邻区域增加5-10%的基础加成
    - 最大叠加5个区域（25-50%额外加成）

- **区域资源产出**：
  - **基础产出机制**：
    - 不同类型的区域产出特定类型的资源（如山脉产出矿石、森林产出木材）
    - 产出量计算公式：基础产出 × 区域面积系数 × 控制度系数 × 设施加成
    - 基础产出由区域类型和等级决定（如高级矿脉基础产出是低级矿脉的2-3倍）
  
  - **产出类型细分**：
    - **基础资源**：木材、矿石、粮食、水源等（维持宗门基本运作）
    - **高级资源**：灵石、灵草、珍稀矿石等（用于修炼、炼制和升级）
    - **特殊资源**：区域特有资源（如火山区域的火精石、冰川区域的冰髓）
  
  - **控制度影响**：
    - 控制度100%：产出效率100%
    - 控制度70-99%：产出效率70-99%（线性衰减）
    - 控制度30-69%：产出效率30-69%（线性衰减，并有一定概率资源丢失）
    - 控制度0-29%：产出效率0-29%（资源大量丢失，可能引发叛乱）
  
  - **设施加成**：
    - 资源型设施（如矿场、灵田）：直接提升对应资源产出50-200%
    - 辅助型设施（如仓库、运输站）：减少资源损耗5-20%，提升收集效率10-30%
    - 特殊设施（如聚灵阵）：提升高级资源产出20-50%
  
  - **动态调整机制**：
    - 季节变化影响：如雨季提升木材产出，旱季减少粮食产出
    - 环境事件影响：如矿脉枯竭（临时减少产出）、灵脉复苏（临时增加产出）
    - 宗门科技影响：解锁资源增产技术可永久提升产出效率10-30%

- **区域间互动**：
  - **相邻区域影响**：
    - 相邻区域的控制度互相影响，高控制度区域可提升相邻区域5-10%的稳定性
    - 环境效应传播，如森林火灾可能影响相邻区域
    - 资源类型互补，相邻区域可形成资源互补效应
  
  - **战略协同效应**：
    - 占领互补类型区域获得协同加成（如森林和山脉区域同时控制，木材和矿石产出各提升10%）
    - 关键区域控制可影响大范围区域的资源流动
    - 中心区域发展可带动周边区域发展

- **地图服务组件**：
  - **MapService**：管理地图的整体结构和状态
  - **RegionService**：管理大区域的信息和状态
  - **SubRegionService**：管理小区域的占领和资源产出
  - **ControlService**：计算区域控制度和完全占领状态

## 4. 实现计划

### 4.1 第一阶段：基础框架搭建（1周）
- **核心任务**：基于lko-ecs4框架创建游戏核心引擎
- **具体目标**：
  - 实现World、Entity、Component、Service等ECS基础架构
  - 创建游戏世界初始化机制，支持基础时间管理
  - 实现基础的角色、宗门、资源组件系统
  - 完成基础的数据存储和序列化机制

### 4.2 第二阶段：AI角色系统实现（2周）
- **核心任务**：实现AI角色的自主决策和行为系统
- **具体目标**：
  - 实现角色属性系统（修为、资质、性格等）
  - 开发基于GOAP的目标导向决策算法
  - 支持角色层级管理（掌门→长老→亲传弟子→内门弟子）
  - 实现角色行为系统（修炼、管理、工作、社交等）
  - 完成角色间互动和影响机制

### 4.3 第三阶段：宗门世界实现（2周）
- **核心任务**：构建完整的宗门管理和资源系统
- **具体目标**：
  - 实现宗门结构管理（核心管理层和资源层）
  - 完成人口资源系统（凡俗百姓、宗门杂役、外门弟子）
  - 实现资源管理（获取、消耗、分配、转换）
  - 完成设施系统（建设、维护、升级、运行）
  - 实现地图系统（区域分层、占领机制、资源产出）

### 4.4 第四阶段：玩家交互与界面（1周）
- **核心任务**：实现玩家与游戏世界的交互界面
- **具体目标**：
  - 实现文字命令输入和解析系统
  - 开发游戏状态展示界面（宗门状态、角色信息、资源状态）
  - 支持玩家决策干预（重要决策投票、直接命令）
  - 完成游戏历史记录和回溯功能

### 4.5 第五阶段：测试与优化（1周）
- **核心任务**：全面测试和性能优化
- **具体目标**：
  - 功能测试：验证所有核心功能正常运行
  - 性能测试：确保100+ AI角色和10万+人口资源的管理效率
  - 平衡性测试：调整资源产出和消耗的平衡
  - 用户体验优化：改进界面交互和响应速度

## 5. 验收标准

### 5.1 功能验收
- [ ] **游戏启动与运行**：游戏能够正常启动，无崩溃或严重错误，支持基本的游戏循环
- [ ] **AI角色层级控制**：实现掌门→长老→亲传弟子→内门弟子的完整层级管理，每个层级具有不同的权限和行为模式
- [ ] **AI自主决策**：AI角色能够基于属性、职位和当前状态进行自主决策，决策响应时间<1秒
- [ ] **人口资源系统**：凡俗百姓、宗门杂役、外门弟子作为资源处理，实现自动产出和维持成本计算
- [ ] **资源管理**：支持资源的获取、消耗、分配和转换，资源流动路径清晰可追踪
- [ ] **设施系统**：设施能够正常建设、维护和升级，提供对资源产出的加成效果（5-50%）
- [ ] **地图系统**：实现区域分层结构，支持区域占领、控制度管理和资源产出计算
- [ ] **玩家交互**：支持至少20种文字命令，能够查询宗门状态、角色信息和资源状态

### 5.2 性能验收
- [ ] **运行流畅性**：游戏运行无卡顿，世界更新周期稳定在1-5秒范围内
- [ ] **AI角色性能**：支持同时运行100+ AI角色，每个角色的决策计算时间<100ms
- [ ] **人口资源管理**：支持管理10万+人口资源，资源计算和分配响应时间<500ms
- [ ] **内存使用**：游戏运行内存占用控制在1GB以内
- [ ] **数据存储**：游戏状态能够正确保存和加载，无数据丢失或损坏

### 5.3 代码验收
- [ ] 代码结构清晰，符合ECS框架设计原则
- [ ] 组件和系统分离，易于维护和扩展
- [ ] 代码注释完善，便于理解

## 6. 技术栈

- **核心框架**：lko-ecs4（项目现有的ECS框架）
- **开发语言**：Kotlin
- **构建工具**：Gradle
- **运行环境**：JVM

## 7. 预期交付时间

项目预计在X周内完成，具体时间安排如下：
- 第一阶段：1周
- 第二阶段：2周
- 第三阶段：2周
- 第四阶段：1周
- 第五阶段：1周

总交付时间：约7周

## 8. 风险评估

### 8.1 技术风险
- ECS框架的性能优化：大量AI角色可能导致性能问题
- AI决策算法的复杂度：需要平衡决策质量和性能

### 8.2 功能风险
- 角色行为的多样性：需要确保AI角色行为丰富且合理
- 世界事件的平衡性：随机事件需要保持游戏的趣味性和挑战性

### 8.3 应对策略
- 进行性能测试和优化，确保游戏运行流畅
- 迭代开发AI决策算法，逐步提升决策质量
- 收集用户反馈，不断调整游戏平衡

---

**文档版本**：2.0
**更新日期**：2025-12-20
**编写人**：AI Assistant
**更新说明**：
- 修复文档结构问题（编号重复）
- 优化技术架构与ECS框架的匹配度
- 简化地图系统复杂度，使其更符合文字游戏范围
- 完善系统互动关系和资源流动机制
- 优化验收标准和实现计划，增加可量化指标