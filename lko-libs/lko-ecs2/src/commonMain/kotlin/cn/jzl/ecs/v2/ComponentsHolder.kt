package cn.jzl.ecs.v2

/**
 * ComponentsHolder - 组件持有器接口
 * 
 * 核心职责：
 * - 管理特定类型组件的实例集合
 * - 提供实体与组件之间的映射关系
 * - 支持组件的添加、获取、移除等基本操作
 * - 维护实体拥有组件的状态
 * 
 * 组件持有器是ECS框架中连接实体和组件数据的关键组件，
 * 每种组件类型都有一个对应的持有器实例。
 * 
 * @param C 组件类型
 */
interface ComponentsHolder<C> {
    /**
     * 此持有器管理的组件类型
     */
    val componentType: ComponentType<C>

    /**
     * 检查实体是否拥有此类型的组件 - 实现contains运算符
     * 
     * 实现逻辑：
     * 1. 验证实体ID的有效性
     * 2. 检查实体是否在组件持有器的内部映射中
     * 3. 返回检查结果
     * 
     * 这个方法通常通过快速查找内部数据结构（如哈希表或数组）来实现，
     * 确保即使在大量实体的情况下也能保持高性能。
     * 
     * @param entity 要检查的实体
     * @return 如果实体拥有此类型组件返回true，否则返回false
     */
    operator fun contains(entity: Entity): Boolean

    /**
     * 获取实体的组件 - 实现get运算符
     * 
     * 实现逻辑：
     * 1. 验证实体是否拥有此类型的组件
     * 2. 如果拥有，从内部映射中检索组件实例
     * 3. 如果不拥有，抛出NoSuchElementException异常
     * 
     * 这个方法提供了类型安全的组件访问方式，确保调用者始终获得有效的组件实例，
     * 适用于已知实体一定拥有该组件的场景。
     * 
     * @param entity 要获取组件的实体
     * @return 实体的组件实例
     * @throws NoSuchElementException 如果实体没有此类型组件
     */
    operator fun get(entity: Entity): C

    /**
     * 设置实体的组件 - 实现set运算符
     * 
     * 实现逻辑：
     * 1. 验证实体ID的有效性
     * 2. 检查实体是否已拥有此类型组件
     * 3. 存储新的组件实例，更新内部映射
     * 4. 返回替换前的组件实例（如果存在）
     * 5. 通知相关系统组件已更新
     * 
     * 这个方法用于添加新组件或更新现有组件，它返回旧组件的能力允许
     * 调用者执行必要的清理或比较操作，是组件更新机制的核心。
     * 
     * @param entity 要设置组件的实体
     * @param component 组件实例
     * @return 替换前的组件实例，如果不存在则返回null
     */
    operator fun set(entity: Entity, component: C): C?

    /**
     * 获取实体的组件，如果不存在则返回null
     * 
     * 实现逻辑：
     * 1. 验证实体ID的有效性
     * 2. 尝试从内部映射中检索组件实例
     * 3. 如果找到返回组件实例，如果未找到返回null
     * 
     * 这个方法提供了空安全的组件访问方式，避免了在不确定实体是否拥有组件时的异常处理，
     * 适用于需要条件性处理组件的场景。
     * 
     * @param entity 要获取组件的实体
     * @return 实体的组件实例，如果不存在则返回null
     */
    fun getOrNull(entity: Entity): C?

    /**
     * 从实体中移除组件
     * 
     * 实现逻辑：
     * 1. 验证实体ID的有效性
     * 2. 检查实体是否拥有此类型组件
     * 3. 如果拥有，从内部映射中移除组件实例
     * 4. 返回被移除的组件实例（如果存在）
     * 5. 更新实体的组件状态
     * 6. 通知相关系统组件已移除
     * 
     * 这个方法负责清理组件资源和维护实体的组件状态，确保系统的一致性。
     * 返回被移除的组件允许调用者执行必要的资源释放或状态迁移。
     * 
     * @param entity 要移除组件的实体
     * @return 被移除的组件实例，如果不存在则返回null
     */
    fun remove(entity: Entity): C?
}