# 功能规范: 最小 demo 集（验证核心基础设施）

**功能分支**: `003-minimal-demo-set`
**创建时间**: 2025-12-21
**状态**: 草稿
**输入**: 用户描述: "最小 demo 集：在现有 Kotlin Multiplatform 多模块工程中提供一组最小可运行 demo，用于验证核心基础设施（至少能跑一个单元测试、一个桌面运行入口或简单示例），优先落到 lko-sect 或 tests/lko-gdx-test 等现有模块。"

## 用户场景与测试 *(必填)*

### 用户故事 1 - 我能一键跑通最小单元测试以验证 KMP 测试链路 (优先级: P0)

作为开发者/贡献者，我希望仓库内有一个“最小但有意义”的单元测试示例，能够在不理解全部业务代码的情况下跑通，从而快速验证：Gradle 配置、Kotlin Multiplatform 测试任务、依赖解析与基础断言框架均正常工作。

**优先级原因**: 单元测试是最基础的质量闸门；它不依赖图形环境，适合作为 CI 与本地环境的最小验证。

**最小可运行产物**:
- 一个可直接执行的测试类（例如 `...Test.kt`），位于 `lko-sect` 的 `commonTest`（优先）或已有的可运行测试模块中。

**验收场景**:

1. **Given** 仓库为干净工作区且已完成依赖下载，**When** 我运行最小测试任务，**Then** 至少有 1 个测试用例通过且输出包含测试通过摘要
2. **Given** 我在离线/网络不稳定环境下已完成一次依赖缓存，**When** 再次运行最小测试任务，**Then** 测试仍能在可接受时间内启动并通过（不要求重新下载依赖）
3. **Given** 测试中包含一个简单的跨平台纯 Kotlin 逻辑（不依赖图形/文件系统），**When** 我运行该测试，**Then** 断言结果稳定且不受运行机器差异影响

---

### 用户故事 2 - 我能启动一个桌面入口以验证“可运行应用”链路 (优先级: P0)

作为开发者/贡献者，我希望仓库内有一个可以启动的桌面运行入口（或最简单的示例应用），用于验证：桌面目标的打包/运行配置、窗口创建与主循环（或最小渲染流程）能够在本机成功启动。

**优先级原因**: 项目包含桌面相关目标与图形/游戏框架基础设施，能否启动桌面入口是验证“能跑起来”的关键。

**最小可运行产物**（满足其一即可）:
- 一个 `main` 入口（桌面端），能够启动并显示窗口/输出关键日志；或
- `tests/lko-gdx-test` 中一个可运行的最小示例（例如一个空白 screen / 简单场景载入）。

**验收场景**:

1. **Given** 我使用默认配置（不改源码、不改本地环境变量），**When** 我运行桌面入口任务，**Then** 程序在 10 秒内可见地启动（窗口出现或日志表明主循环已运行）
2. **Given** 桌面入口启动后，**When** 我关闭窗口/退出程序，**Then** 进程能在 3 秒内正常退出且不残留后台进程
3. **Given** 运行环境缺少可选资源（例如可选贴图/字体并非必须），**When** 我启动桌面入口，**Then** 程序仍能启动并给出用户可理解的降级提示（例如“使用默认资源/跳过渲染内容”）

---

### 用户故事 3 - 我能运行一个最小集成示例以验证模块间依赖与基础设施连通性 (优先级: P1)

作为开发者/贡献者，我希望有一个“跨模块的最小集成示例”，以验证至少一条典型依赖路径可用（例如：核心模块 → 工具/DI/序列化/图形测试模块之一），从而证明多模块结构在最小场景下可组合、可运行。

**优先级原因**: 即使单元测试与桌面入口都能跑通，模块间的依赖与初始化链路仍可能在真实使用时失败；最小集成示例可以提前暴露问题。

**最小可运行产物**（满足其一即可，优先不依赖图形环境）:
- 一个集成测试类：在测试中完成“创建最小对象图/初始化一次核心服务/执行一次无副作用的调用”并断言结果；或
- 一个命令行式的最小示例（如 `main` 输出关键步骤日志），用于演示模块组合。

**验收场景**:

1. **Given** 示例依赖至少 2 个现有模块（例如 `lko-sect` + `lko-di` / `lko-ecs4` / `lko-ecs-serialization` 中任意一个），**When** 我运行集成示例，**Then** 示例能执行到结束且输出/断言表明依赖初始化成功
2. **Given** 示例中包含一次最小“数据来回”（例如：构建一个对象 → 序列化 → 反序列化 或 创建一个状态 → 应用一个变更），**When** 运行示例，**Then** 关键字段保持一致且结果可重复
3. **Given** 运行发生失败（例如缺少资源、配置错误），**When** 示例退出，**Then** 错误信息应指向可操作的原因（例如提示缺少哪个模块/任务/资源），而不是无上下文的空指针/栈追踪噪声

---

### 边界情况

- 在未安装/未配置图形驱动的环境中：桌面入口可允许失败，但必须能清晰提示“需要图形环境”并给出替代验证路径（如运行单元测试）
- 在 CI（无窗口）环境：不强制运行桌面入口，但必须能运行最小单元测试与（若选择）无图形依赖的集成示例
- 当首次构建依赖下载较慢：规范不要求首次运行时间指标，但要求再次运行（依赖已缓存）能稳定通过
- 当模块 API 发生演进导致示例失效：示例应足够小，维护成本低；一处变更能快速修复
- 当示例依赖资源文件（如 shader/字体）：必须提供“无资源也能跑”的降级策略或改为不依赖资源

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系统必须提供一个“最小单元测试 demo”，并将其放置在现有模块中（优先 `lko-sect/src/commonTest`），确保贡献者无需创建新模块即可运行
- **FR-002**: 最小单元测试 demo 必须只依赖纯 Kotlin 逻辑（不依赖窗口、GPU、文件读写或网络），以确保在本地与 CI 环境稳定运行
- **FR-003**: 系统必须提供一个“桌面可运行 demo”（`main` 入口或等价运行任务），优先落在现有可运行示例模块（如 `tests/lko-gdx-test`）或现有 desktop 目标中
- **FR-004**: 桌面可运行 demo 必须在启动后给出可观察信号（窗口、标题变化或关键日志均可），使用户能判断“确实跑起来了”
- **FR-005**: 系统必须提供一个“最小集成 demo”，用于验证至少 2 个现有模块的组合可用，并通过测试断言或可重复输出进行验证
- **FR-006**: 每个 demo 必须在规范中明确其“最小可运行产物”类型与位置（测试类 / main / screen），并给出对应的运行方式（以仓库现有 Gradle 任务命名为准，可在后续 plan 中补充）
- **FR-007**: demo 集必须遵循“最小化”原则：每个 demo 只覆盖一条核心链路，不引入额外的业务功能与复杂资源

### 非功能需求（约束）

- **FR-008**: demo 集必须尽量复用现有模块与既有依赖（优先 `lko-sect`、`tests/lko-gdx-test`），避免引入新的外部依赖或新的子项目
- **FR-009**: demo 集必须以中文文档说明为主（本 spec 及后续 quickstart/plan），便于仓库现有受众理解

### Demo 清单（规范级别的“最小产物”定义）

> 注：本节描述“要有什么”，不规定“如何实现”。具体文件名与任务名在 plan 阶段细化。

1. **Demo A：最小单元测试（P0）**
   - **落点模块（优先）**: `lko-sect`
   - **最小可运行产物**: 1 个测试类 + 1 个测试用例
   - **验证点**: 测试任务可运行、断言框架可用、跨平台纯逻辑可被测试

2. **Demo B：桌面运行入口（P0）**
   - **落点模块（优先）**: `tests/lko-gdx-test`（或仓库中已有 desktopMain 目标）
   - **最小可运行产物**: 1 个桌面 `main` 或 1 个最小 screen 示例
   - **验证点**: 桌面任务可启动、用户能观察到运行状态、可正常退出

3. **Demo C：最小集成示例（P1）**
   - **落点模块（优先）**: `lko-sect`（集成测试）或与其相邻依赖模块组合
   - **最小可运行产物**: 1 个集成测试类（优先）或 1 个命令行示例 `main`
   - **验证点**: 至少 2 个模块可组合、初始化成功、一次最小数据来回可重复

## 成功标准 *(必填)*

- **SC-001**: 新贡献者在不修改源码的前提下，能够在 5 分钟内找到并运行“最小单元测试 demo”，且至少 1 个测试通过
- **SC-002**: 在常见开发机上，桌面 demo 从启动到出现可观察信号（窗口/日志）不超过 10 秒（首次下载依赖不计入）
- **SC-003**: 关闭桌面 demo 后，进程在 3 秒内退出且不残留后台进程
- **SC-004**: 最小集成 demo 能稳定重复运行 5 次均成功（无偶发失败），用于证明链路可靠
- **SC-005**: demo 集的失败提示信息对非作者也可操作：当失败发生时，用户能在 2 分钟内从输出中判断下一步（例如要运行哪个任务、缺少什么环境）

## 关键实体（可选）

- **Demo**: 用于验证某条基础设施链路的最小可运行示例（测试类 / main / screen）
- **Demo Runner**: 执行 demo 的入口（测试任务或运行任务），需能产生可观察结果
- **基础设施链路**: 构建 → 依赖解析 → 运行时初始化 → 可观察输出/断言通过

## 假设（可选）

- 仓库已具备可用的 Gradle Wrapper，贡献者以标准方式运行任务即可
- `lko-sect` 与 `tests/lko-gdx-test` 已纳入现有构建/测试体系（如未纳入，plan 阶段需先补齐任务接入）
- demo 的目标是验证“基础设施可用”，而不是展示完整游戏玩法

## 开放问题（可选）

- [NEEDS CLARIFICATION: 范围] 桌面 demo “可观察信号”的最低要求是什么：必须出现窗口，还是仅日志也可接受？
- [NEEDS CLARIFICATION: 运行入口] 是否需要为 demo 集提供统一入口（例如一个聚合任务/文档页），还是分别运行即可？
